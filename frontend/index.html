<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AURA V3 - Hybrid AI DAW Mockup</title>
    <!-- Tone.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Background Colors - BRIGHTER */
            --bg-main: #252530;
            --bg-gap: #020202;
            --bg-panel: #3A3D45;
            --bg-input: #32353D;
            --bg-transport: #2A2A35;

            /* Chat Colors */
            --chat-user: #2A3547;
            --chat-ai: #263D30;

            /* Track Colors - Dark backgrounds with neon borders */
            --chord-bg: #1E3A5F;
            --chord-border: #4A90D9;
            --drums-bg: #4A2020;
            --drums-border: #E85D4E;
            --bass-bg: #1E3D2F;
            --bass-border: #4FD272;
            --piano-bg: #1E3A4A;
            --piano-border: #5DADE2;
            --vocal-bg: #3D2050;
            --vocal-border: #9D65D8;

            /* Legacy - keep for compatibility */
            --chord-region: #314963;
            --track-chord: #314963;
            --track-drums: #E85D4E;
            --track-bass: #4FD272;
            --track-piano: #5DADE2;
            --track-vocal: #9D65D8;

            /* Button Colors */
            --rec-bg: #9B4342;
            --rec-circle: #F95F5B;
            --neon-cyan: #4DFFFF;
            --neon-purple: #D45FFF;

            /* Text Colors */
            --text-main: #C0C6C5;
            --text-muted: #808590;

            /* Layout */
            --corner-radius: 6px;
            --corner-radius-lg: 8px;
            --panel-gap: 6px;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background-color: var(--bg-gap);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden;
        }

        /* Main Layout */
        .app-container {
            display: grid;
            grid-template-rows: 60px 1fr;
            grid-template-columns: 280px 1fr 300px;
            height: 100vh;
            gap: var(--panel-gap);
            padding: var(--panel-gap);
        }

        /* Header - spans full width */
        .header {
            grid-column: 1 / -1;
            background-color: var(--bg-main);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            border-radius: var(--corner-radius-lg);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .project-name {
            font-size: 16px;
            color: var(--text-main);
        }

        .undo-redo-group {
            display: flex;
            gap: 8px;
            margin-left: 12px;
        }

        .undo-redo-btn {
            background: transparent;
            border: none;
            width: 24px;
            height: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }

        .undo-redo-btn svg {
            width: 20px;
            height: 20px;
            stroke: #888888;
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            transition: stroke 0.15s ease;
        }

        .undo-redo-btn:hover svg {
            stroke: #CCCCCC;
        }

        .header-btn {
            background: var(--bg-panel);
            border: none;
            color: var(--text-main);
            padding: 8px 16px;
            border-radius: var(--corner-radius);
            cursor: pointer;
            font-size: 12px;
        }

        .header-btn:hover {
            opacity: 0.8;
        }

        /* Transport Controls - Grouped in Box */
        .header-center {
            display: flex;
            align-items: center;
            gap: 0;
        }

        .transport-group {
            display: flex;
            align-items: center;
            background: #0A0A0C;
            border-radius: 10px;
            padding: 6px;
            gap: 6px;
        }

        .transport-btn {
            width: 42px;
            height: 42px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s ease;
            outline: none;
        }

        .transport-btn:focus {
            outline: none;
        }

        .rec-btn:focus {
            outline: none;
        }

        /* Play Button - Green Neon (#4FD272) */
        .play-btn {
            background: rgba(79, 210, 114, 0.08);
            border: 1px solid rgba(79, 210, 114, 0.3);
            box-shadow: 0 0 6px rgba(79, 210, 114, 0.2),
                        inset 0 0 8px rgba(79, 210, 114, 0.05);
        }

        .play-btn:hover {
            background: rgba(79, 210, 114, 0.15);
            border-color: rgba(79, 210, 114, 0.5);
            box-shadow: 0 0 12px rgba(79, 210, 114, 0.4),
                        0 0 25px rgba(79, 210, 114, 0.2),
                        inset 0 0 15px rgba(79, 210, 114, 0.1);
        }

        .play-btn:active {
            background: rgba(79, 210, 114, 0.25);
            border-color: rgba(79, 210, 114, 0.7);
            box-shadow: 0 0 20px rgba(79, 210, 114, 0.6),
                        0 0 40px rgba(79, 210, 114, 0.3),
                        0 0 60px rgba(79, 210, 114, 0.15),
                        inset 0 0 20px rgba(79, 210, 114, 0.15);
            transform: scale(0.95);
        }

        .play-icon {
            width: 0;
            height: 0;
            border-left: 14px solid #4FD272;
            border-top: 9px solid transparent;
            border-bottom: 9px solid transparent;
            margin-left: 4px;
            filter: drop-shadow(0 0 4px rgba(79, 210, 114, 0.6));
            transition: all 0.15s ease;
        }

        .play-btn:hover .play-icon {
            filter: drop-shadow(0 0 8px rgba(79, 210, 114, 0.8));
        }

        .play-btn:active .play-icon {
            border-left-color: #80FF99;
            filter: drop-shadow(0 0 12px rgba(79, 210, 114, 1));
        }

        /* Play Button - Playing State (Neon Glow ON) */
        .play-btn.playing {
            background: rgba(79, 210, 114, 0.25);
            border-color: rgba(79, 210, 114, 0.8);
            box-shadow: 0 0 15px rgba(79, 210, 114, 0.6),
                        0 0 30px rgba(79, 210, 114, 0.4),
                        0 0 50px rgba(79, 210, 114, 0.2),
                        inset 0 0 15px rgba(79, 210, 114, 0.15);
            animation: playGlow 1.5s ease-in-out infinite;
        }

        .play-btn.playing .play-icon {
            border-left-color: #80FF99;
            filter: drop-shadow(0 0 10px rgba(79, 210, 114, 1));
        }

        @keyframes playGlow {
            0%, 100% {
                box-shadow: 0 0 15px rgba(79, 210, 114, 0.6),
                            0 0 30px rgba(79, 210, 114, 0.4),
                            0 0 50px rgba(79, 210, 114, 0.2),
                            inset 0 0 15px rgba(79, 210, 114, 0.15);
            }
            50% {
                box-shadow: 0 0 20px rgba(79, 210, 114, 0.8),
                            0 0 40px rgba(79, 210, 114, 0.5),
                            0 0 60px rgba(79, 210, 114, 0.3),
                            inset 0 0 20px rgba(79, 210, 114, 0.2);
            }
        }

        /* Stop Button - Yellow Neon (#FFD84D) */
        .stop-btn {
            background: rgba(255, 216, 77, 0.08);
            border: 1px solid rgba(255, 216, 77, 0.3);
            box-shadow: 0 0 6px rgba(255, 216, 77, 0.2),
                        inset 0 0 8px rgba(255, 216, 77, 0.05);
        }

        .stop-btn:hover {
            background: rgba(255, 216, 77, 0.15);
            border-color: rgba(255, 216, 77, 0.5);
            box-shadow: 0 0 12px rgba(255, 216, 77, 0.4),
                        0 0 25px rgba(255, 216, 77, 0.2),
                        inset 0 0 15px rgba(255, 216, 77, 0.1);
        }

        .stop-btn:active,
        .stop-btn.pressed {
            background: rgba(255, 216, 77, 0.25);
            border-color: rgba(255, 216, 77, 0.7);
            box-shadow: 0 0 20px rgba(255, 216, 77, 0.6),
                        0 0 40px rgba(255, 216, 77, 0.3),
                        0 0 60px rgba(255, 216, 77, 0.15),
                        inset 0 0 20px rgba(255, 216, 77, 0.15);
            transform: scale(0.95);
        }

        .stop-icon {
            width: 14px;
            height: 14px;
            background: #FFD84D;
            border-radius: 2px;
            box-shadow: 0 0 4px rgba(255, 216, 77, 0.6);
            transition: all 0.15s ease;
        }

        .stop-btn:hover .stop-icon {
            box-shadow: 0 0 8px rgba(255, 216, 77, 0.8);
        }

        .stop-btn:active .stop-icon {
            background: #FFEB80;
            box-shadow: 0 0 12px rgba(255, 216, 77, 1);
        }

        .rec-btn {
            background: rgba(249, 95, 91, 0.08);
            width: 42px;
            height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(249, 95, 91, 0.3);
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 0 8px rgba(249, 95, 91, 0.2),
                        inset 0 0 10px rgba(249, 95, 91, 0.05);
            transition: all 0.15s ease;
        }

        .rec-btn:hover {
            background: rgba(249, 95, 91, 0.15);
            border-color: rgba(249, 95, 91, 0.5);
            box-shadow: 0 0 12px rgba(249, 95, 91, 0.4),
                        0 0 25px rgba(249, 95, 91, 0.2),
                        inset 0 0 15px rgba(249, 95, 91, 0.1);
        }

        .rec-btn:active {
            background: rgba(249, 95, 91, 0.25);
            border-color: rgba(249, 95, 91, 0.7);
            box-shadow: 0 0 20px rgba(249, 95, 91, 0.6),
                        0 0 40px rgba(249, 95, 91, 0.3),
                        0 0 60px rgba(249, 95, 91, 0.15),
                        inset 0 0 20px rgba(249, 95, 91, 0.15);
            transform: scale(0.95);
        }

        .rec-btn .circle {
            width: 20px;
            height: 20px;
            background: var(--rec-circle);
            border-radius: 50%;
            box-shadow: 0 0 8px rgba(249, 95, 91, 0.6),
                        0 0 15px rgba(249, 95, 91, 0.3);
            transition: box-shadow 0.15s ease;
        }

        .rec-btn:hover .circle {
            box-shadow: 0 0 12px rgba(249, 95, 91, 0.8),
                        0 0 25px rgba(249, 95, 91, 0.5);
        }

        .rec-btn:active .circle {
            box-shadow: 0 0 18px rgba(249, 95, 91, 1),
                        0 0 35px rgba(249, 95, 91, 0.7),
                        0 0 50px rgba(249, 95, 91, 0.4);
        }

        /* Record Button - Recording State (ON) */
        .rec-btn.recording {
            background: rgba(249, 95, 91, 0.3);
            border-color: rgba(249, 95, 91, 0.9);
            box-shadow: 0 0 20px rgba(249, 95, 91, 0.7),
                        0 0 40px rgba(249, 95, 91, 0.4),
                        0 0 60px rgba(249, 95, 91, 0.2),
                        inset 0 0 15px rgba(249, 95, 91, 0.2);
            animation: recPulse 1s ease-in-out infinite;
        }

        .rec-btn.recording .circle {
            background: #FF6B6B;
            box-shadow: 0 0 15px rgba(249, 95, 91, 1),
                        0 0 30px rgba(249, 95, 91, 0.7),
                        0 0 45px rgba(249, 95, 91, 0.4);
            animation: recCirclePulse 1s ease-in-out infinite;
        }

        @keyframes recPulse {
            0%, 100% {
                box-shadow: 0 0 20px rgba(249, 95, 91, 0.7),
                            0 0 40px rgba(249, 95, 91, 0.4),
                            0 0 60px rgba(249, 95, 91, 0.2),
                            inset 0 0 15px rgba(249, 95, 91, 0.2);
            }
            50% {
                box-shadow: 0 0 25px rgba(249, 95, 91, 0.9),
                            0 0 50px rgba(249, 95, 91, 0.5),
                            0 0 70px rgba(249, 95, 91, 0.3),
                            inset 0 0 20px rgba(249, 95, 91, 0.25);
            }
        }

        @keyframes recCirclePulse {
            0%, 100% {
                box-shadow: 0 0 15px rgba(249, 95, 91, 1),
                            0 0 30px rgba(249, 95, 91, 0.7),
                            0 0 45px rgba(249, 95, 91, 0.4);
                transform: scale(1);
            }
            50% {
                box-shadow: 0 0 20px rgba(249, 95, 91, 1),
                            0 0 40px rgba(249, 95, 91, 0.8),
                            0 0 55px rgba(249, 95, 91, 0.5);
                transform: scale(1.05);
            }
        }

        .transport-divider {
            width: 1px;
            height: 36px;
            background: #303035;
            margin: 0 8px;
        }

        .tempo-box {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            padding: 0 12px 0 6px;
        }

        .bpm-value {
            color: var(--text-main);
            font-size: 18px;
            font-weight: 500;
            line-height: 1.2;
        }

        .key-display {
            color: #606570;
            font-size: 12px;
            margin-top: 2px;
        }

        /* Header Right */
        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .magic-mix-btn {
            background: rgba(77, 255, 255, 0.05);
            border: 2px solid var(--neon-cyan);
            color: var(--neon-cyan);
            padding: 10px 20px;
            border-radius: var(--corner-radius-lg);
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            text-shadow: 0 0 10px rgba(77, 255, 255, 0.8);
            box-shadow: 0 0 8px rgba(77, 255, 255, 0.4),
                        0 0 20px rgba(77, 255, 255, 0.2),
                        0 0 40px rgba(77, 255, 255, 0.1),
                        inset 0 0 15px rgba(77, 255, 255, 0.05);
            transition: all 0.15s ease;
        }

        .magic-mix-btn:hover {
            background: rgba(77, 255, 255, 0.1);
            text-shadow: 0 0 15px rgba(77, 255, 255, 1);
            box-shadow: 0 0 12px rgba(77, 255, 255, 0.6),
                        0 0 30px rgba(77, 255, 255, 0.4),
                        0 0 60px rgba(77, 255, 255, 0.2),
                        inset 0 0 20px rgba(77, 255, 255, 0.1);
        }

        .magic-mix-btn:active {
            background: rgba(77, 255, 255, 0.25);
            border-color: #80FFFF;
            color: #FFFFFF;
            text-shadow: 0 0 20px rgba(77, 255, 255, 1),
                         0 0 40px rgba(77, 255, 255, 0.8);
            box-shadow: 0 0 20px rgba(77, 255, 255, 0.8),
                        0 0 40px rgba(77, 255, 255, 0.5),
                        0 0 80px rgba(77, 255, 255, 0.3),
                        inset 0 0 30px rgba(77, 255, 255, 0.2);
            transform: scale(0.98);
        }

        .export-btn {
            background: rgba(212, 95, 255, 0.05);
            border: 2px solid var(--neon-purple);
            color: var(--neon-purple);
            padding: 10px 20px;
            border-radius: var(--corner-radius-lg);
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            text-shadow: 0 0 10px rgba(212, 95, 255, 0.8);
            box-shadow: 0 0 8px rgba(212, 95, 255, 0.4),
                        0 0 20px rgba(212, 95, 255, 0.2),
                        0 0 40px rgba(212, 95, 255, 0.1),
                        inset 0 0 15px rgba(212, 95, 255, 0.05);
            transition: all 0.15s ease;
        }

        .export-btn:hover {
            background: rgba(212, 95, 255, 0.1);
            text-shadow: 0 0 15px rgba(212, 95, 255, 1);
            box-shadow: 0 0 12px rgba(212, 95, 255, 0.6),
                        0 0 30px rgba(212, 95, 255, 0.4),
                        0 0 60px rgba(212, 95, 255, 0.2),
                        inset 0 0 20px rgba(212, 95, 255, 0.1);
        }

        .export-btn:active {
            background: rgba(212, 95, 255, 0.25);
            border-color: #E080FF;
            color: #FFFFFF;
            text-shadow: 0 0 20px rgba(212, 95, 255, 1),
                         0 0 40px rgba(212, 95, 255, 0.8);
            box-shadow: 0 0 20px rgba(212, 95, 255, 0.8),
                        0 0 40px rgba(212, 95, 255, 0.5),
                        0 0 80px rgba(212, 95, 255, 0.3),
                        inset 0 0 30px rgba(212, 95, 255, 0.2);
            transform: scale(0.98);
        }

        /* Icon Buttons */
        .icon-btn {
            background: var(--bg-panel);
            border: none;
            color: var(--text-main);
            width: 40px;
            height: 40px;
            border-radius: var(--corner-radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .icon-btn:hover {
            background: var(--bg-input);
        }

        /* Mixer Icon - 4 vertical bars */
        .mixer-icon {
            display: flex;
            gap: 3px;
            align-items: flex-end;
            height: 18px;
        }

        .mixer-bar {
            width: 3px;
            background: var(--text-main);
            border-radius: 1px;
        }

        .mixer-bar:nth-child(1) { height: 12px; }
        .mixer-bar:nth-child(2) { height: 18px; }
        .mixer-bar:nth-child(3) { height: 10px; }
        .mixer-bar:nth-child(4) { height: 15px; }

        /* Project Meta Icon - LP disc */
        .disc-icon {
            width: 20px;
            height: 20px;
            border: 2px solid var(--text-main);
            border-radius: 50%;
            position: relative;
        }

        .disc-icon::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 6px;
            height: 6px;
            background: var(--text-main);
            border-radius: 50%;
        }

        /* Resource Browser (Left Sidebar) */
        .resource-browser {
            background-color: var(--bg-main);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border-radius: var(--corner-radius-lg);
        }

        .sidebar-section {
            padding: 0 15px 15px 15px;
        }

        /* Engraved Panel Title Style - Clear & Readable */
        .section-title {
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2.5px;
            color: #5A5D65;
            text-shadow:
                0 1px 0 rgba(200, 205, 215, 0.5),
                0 -1px 0 rgba(0, 0, 0, 0.7);
            margin-bottom: 10px;
            text-align: center;
            padding: 6px 0;
            border-bottom: 1px solid #2A2D33;
        }

        .ai-generate-box {
            background: var(--bg-panel);
            border-radius: var(--corner-radius);
            padding: 15px;
            margin-bottom: 15px;
        }

        .ai-generate-box .desc {
            color: var(--text-muted);
            font-size: 12px;
            margin-bottom: 10px;
        }

        .prompt-input {
            background: var(--bg-input);
            border: 1px solid var(--bg-panel);
            border-radius: var(--corner-radius);
            color: var(--text-main);
            padding: 10px;
            width: 100%;
            height: 60px;
            resize: none;
            font-size: 12px;
            margin-bottom: 10px;
        }

        .generate-btn {
            background: rgba(77, 255, 255, 0.2);
            border: 1px solid var(--neon-cyan);
            color: var(--neon-cyan);
            padding: 8px 16px;
            border-radius: var(--corner-radius);
            cursor: pointer;
            font-size: 12px;
            float: right;
        }

        .menu-item {
            background: var(--bg-input);
            border-radius: var(--corner-radius);
            padding: 12px 15px;
            margin-bottom: 8px;
            cursor: pointer;
            font-size: 13px;
        }

        .menu-item:hover {
            background: var(--bg-panel);
        }

        /* Main Content Area */
        .main-content {
            display: grid;
            grid-template-rows: 1fr 380px;
            gap: var(--panel-gap);
        }

        /* Timeline */
        .timeline {
            background-color: var(--bg-main);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border-radius: var(--corner-radius-lg);
        }

        .timeline-header {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px 15px;
            background: var(--bg-main);
            border-bottom: 1px solid #2A2D33;
            height: 30px;
        }

        .timeline-title {
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2.5px;
            color: #5A5D65;
            text-shadow:
                0 1px 0 rgba(200, 205, 215, 0.5),
                0 -1px 0 rgba(0, 0, 0, 0.7);
        }

        /* Timeline Body - Split Layout */
        .timeline-body {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        /* Track Headers Panel (Left) */
        .track-headers-panel {
            width: 150px;
            min-width: 100px;
            max-width: 300px;
            display: flex;
            flex-direction: column;
            background: var(--bg-main);
        }

        /* Resize Divider */
        .timeline-divider {
            width: 4px;
            background: #2A2D33;
            cursor: col-resize;
            flex-shrink: 0;
            transition: background 0.15s;
        }

        .timeline-divider:hover {
            background: #4A4D55;
        }

        .timeline-divider:active {
            background: var(--neon-cyan);
        }

        /* Track Content Panel (Right) */
        .track-content-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;  /* Hide all scrollbars - use custom scrollbar instead */
            background: var(--bg-main);
        }

        /* Time Ruler */
        .time-ruler {
            display: flex;
            height: 30px;
            background: var(--bg-main);
            border-bottom: 1px solid #2A2D33;
            flex-shrink: 0;
        }

        .time-ruler-header {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
        }

        .expand-tracks-btn {
            width: 22px;
            height: 22px;
            background: transparent;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2px;
            padding: 0;
            transition: all 0.3s ease;
        }

        .expand-tracks-btn:hover .expand-bar {
            background: #909090;
        }

        .expand-tracks-btn:hover .expand-arrow {
            border-left-color: #909090;
        }

        /* Three vertical bars */
        .expand-bar {
            width: 3px;
            height: 14px;
            background: #606570;
            border-radius: 1.5px;
        }

        .expand-bar:nth-child(1) { height: 10px; }
        .expand-bar:nth-child(2) { height: 14px; }
        .expand-bar:nth-child(3) { height: 10px; }

        /* Arrow pointing right */
        .expand-arrow {
            width: 0;
            height: 0;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
            border-left: 8px solid #606570;
            margin-left: 2px;
            transition: all 0.3s ease;
        }

        .track-headers-panel.expanded .expand-tracks-btn {
            transform: rotate(180deg);
        }

        .track-headers-panel.expanded .expand-bar {
            background: var(--neon-cyan);
        }

        .track-headers-panel.expanded .expand-arrow {
            border-left-color: var(--neon-cyan);
        }

        .time-ruler-content {
            flex: 1;
            display: flex;
            position: relative;
            background:
                repeating-linear-gradient(
                    90deg,
                    transparent 0px,
                    transparent 24px,
                    #353540 24px,
                    #353540 25px
                ),
                repeating-linear-gradient(
                    90deg,
                    transparent 0px,
                    transparent 99px,
                    #454550 99px,
                    #454550 100px
                );
        }

        .bar-marker {
            position: absolute;
            top: 4px;
            font-size: 11px;
            font-weight: 500;
            color: #909095;
        }

        .beat-tick {
            position: absolute;
            bottom: 0;
            width: 1px;
            background: #454550;
        }

        .beat-tick.bar {
            height: 12px;
            background: #606065;
        }

        .beat-tick.beat {
            height: 6px;
            background: #404045;
        }

        /* Chord Track - Same style as other tracks */
        .track-color-bar.chord { background: var(--track-chord); }

        /* Chord track content inherits from track-content-row */
        .chord-track-content {
            /* height inherited from .track-content-row */
        }

        .chord-block {
            position: absolute;
            top: 3px;
            bottom: 3px;
            background: var(--chord-border);
            border: 1px solid var(--chord-border);
            border-radius: 0px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 10px;
            font-size: 12px;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .chord-divider {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            color: #505560;
            font-size: 16px;
        }

        /* Tracks Headers List (Left Panel) */
        .track-headers-list {
            flex: 1;
            overflow-y: auto;
            padding-top: 5px;  /* Match spacing between tracks */
        }

        .track-header-row {
            height: 48px;
            display: flex;
            align-items: center;
            padding: 0 6px;
            background: var(--bg-main);
        }

        .track-header-box {
            flex: 1;
            height: 46px;
            background: #353840;
            display: flex;
            align-items: center;
            padding: 0;
            font-size: 13px;
            border-radius: 8px;
            overflow: hidden;
        }

        .track-header-box.selected {
            background: #556070;
        }

        .track-color-bar {
            width: 5px;
            height: 100%;
            flex-shrink: 0;
        }

        .track-color-bar.drums { background: var(--track-drums); }
        .track-color-bar.bass { background: var(--track-bass); }
        .track-color-bar.piano { background: var(--track-piano); }
        .track-color-bar.vocal { background: var(--track-vocal); }

        /* Tracks Content List (Right Panel) */
        .track-content-list {
            flex: 1;
            overflow: hidden;  /* Hide all scrollbars - use custom scrollbar instead */
            position: relative;
            padding-top: 5px;  /* Match spacing between tracks */
            /* Dark background with grid for entire track content area */
            background:
                /* Bar lines (100px) - brighter, more visible */
                repeating-linear-gradient(
                    90deg,
                    transparent 0px,
                    transparent 99px,
                    #3A3A45 99px,
                    #3A3A45 100px
                ),
                /* Beat lines (25px) - subtle */
                repeating-linear-gradient(
                    90deg,
                    transparent 0px,
                    transparent 24px,
                    #1A1A22 24px,
                    #1A1A22 25px
                ),
                #101015;
        }

        .track-content-row {
            height: 48px;
            position: relative;
            background:
                /* Bar lines (100px) - brighter, more visible */
                repeating-linear-gradient(
                    90deg,
                    transparent 0px,
                    transparent 99px,
                    #3A3A45 99px,
                    #3A3A45 100px
                ),
                /* Beat lines (25px) - subtle */
                repeating-linear-gradient(
                    90deg,
                    transparent 0px,
                    transparent 24px,
                    #1A1A22 24px,
                    #1A1A22 25px
                ),
                #101015;
            border-bottom: 1px solid #252530;
        }

        .track-name {
            flex: 1;
            color: var(--text-main);
            padding-left: 10px;
        }

        .track-menu {
            display: grid;
            grid-template-columns: repeat(2, 4px);
            grid-template-rows: repeat(3, 4px);
            gap: 3px;
            cursor: pointer;
            margin-right: 10px;
        }

        .track-menu-dot {
            width: 4px;
            height: 4px;
            background: #505560;
            border-radius: 50%;
        }

        /* Track Header Expandable Controls */
        .track-headers-panel {
            transition: width 0.3s ease;
        }

        .track-headers-panel.expanded {
            width: 280px !important;
        }

        .track-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto;
            margin-right: 8px;
            opacity: 0;
            max-width: 0;
            overflow: hidden;
            transition: opacity 0.3s ease, max-width 0.3s ease;
        }

        .track-headers-panel.expanded .track-controls {
            opacity: 1;
            max-width: 200px;
        }

        .track-headers-panel.expanded .track-name {
            flex: none;
            width: 50px;
        }

        /* Track Knob Controls */
        .track-knob-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
        }

        .track-knob {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #3A3D45;
            border: 2px solid;
            position: relative;
            cursor: pointer;
        }

        .track-knob.volume {
            border-color: #4FD272;
        }

        .track-knob.pan {
            border-color: #5DADE2;
        }

        /* Knob indicator line */
        .track-knob::after {
            content: '';
            position: absolute;
            width: 2px;
            height: 8px;
            background: #FFFFFF;
            top: 3px;
            left: 50%;
            transform: translateX(-50%) rotate(45deg);
            transform-origin: bottom center;
            border-radius: 1px;
        }

        .track-knob.pan::after {
            transform: translateX(-50%) rotate(0deg);
        }

        .track-knob-label {
            font-size: 8px;
            color: #707580;
            text-transform: uppercase;
        }

        /* Track Control Buttons */
        .track-btn {
            width: 20px;
            height: 20px;
            border: none;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #353840;
            color: #707580;
            transition: all 0.15s ease;
        }

        .track-btn:hover {
            background: #454A55;
        }

        .track-btn.mute {
            color: #707580;
        }

        .track-btn.mute.active {
            background: #FFB800;
            color: #1A1A20;
        }

        .track-btn.solo {
            color: #707580;
        }

        .track-btn.solo.active {
            background: #4FD272;
            color: #1A1A20;
        }

        .track-btn.rec {
            color: #707580;
        }

        .track-btn.rec.active {
            background: #FF4444;
            color: #FFFFFF;
        }

        /* Track Regions - Cubase style */
        .track-region {
            position: absolute;
            top: 3px;
            bottom: 3px;
            border-radius: 0px;
            border: 1px solid;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            padding: 2px 6px;
            font-size: 10px;
            font-weight: 700;
            overflow: hidden;
        }

        .track-region .region-label {
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
            z-index: 2;
        }

        /* Track-specific colors - Opaque (unselected) */
        .track-region.drums-region {
            background: var(--drums-border);
            border-color: var(--drums-border);
        }

        .track-region.bass-region {
            background: var(--bass-border);
            border-color: var(--bass-border);
        }

        .track-region.piano-region {
            background: var(--piano-border);
            border-color: var(--piano-border);
        }

        .track-region.vocal-region {
            background: var(--vocal-border);
            border-color: var(--vocal-border);
        }

        /* Selected clip style - Semi-transparent with brighter border */
        .track-region.drums-region.selected {
            background: rgba(232, 93, 78, 0.35);
            border-color: #FF8A7A;
        }
        .track-region.bass-region.selected {
            background: rgba(79, 210, 114, 0.35);
            border-color: #7FFF9A;
        }
        .track-region.piano-region.selected {
            background: rgba(93, 173, 226, 0.35);
            border-color: #8DDFFF;
        }
        .track-region.vocal-region.selected {
            background: rgba(157, 101, 216, 0.35);
            border-color: #C995FF;
        }
        .chord-block.selected {
            background: rgba(74, 144, 217, 0.35);
            border-color: #6AB0FF;
        }

        /* Drum patterns visualization */
        .drum-pattern {
            position: absolute;
            bottom: 4px;
            left: 6px;
            right: 6px;
            top: 18px;
            display: flex;
            align-items: flex-end;
            gap: 3px;
        }

        .drum-hit {
            width: 8px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 0px;
        }

        .drums-region.selected .drum-hit {
            background: var(--drums-border);
        }

        /* Bass/Piano waveform visualization */
        .waveform {
            position: absolute;
            bottom: 4px;
            left: 6px;
            right: 6px;
            top: 18px;
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .wave-bar {
            width: 3px;
            border-radius: 0px;
            background: rgba(255, 255, 255, 0.5);
        }

        .bass-region.selected .wave-bar {
            background: var(--bass-border);
        }

        .piano-region.selected .wave-bar {
            background: var(--piano-border);
        }

        /* Auto-fill ghost region */
        .auto-fill-region {
            position: absolute;
            top: 3px;
            bottom: 3px;
            border: 1px dashed var(--piano-border);
            border-radius: 0px;
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
        }

        .auto-fill-label {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            color: var(--piano-border);
        }

        .auto-fill-arrow {
            font-size: 14px;
        }

        /* Vocal region with waveform */
        .vocal-waveform {
            position: absolute;
            top: 18px;
            bottom: 4px;
            left: 6px;
            right: 6px;
            display: flex;
            align-items: center;
            gap: 1px;
        }

        .vocal-wave {
            width: 2px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 0px;
        }

        .vocal-region.selected .vocal-wave {
            background: var(--vocal-border);
        }

        .vocal-circle {
            position: absolute;
            left: 6px;
            top: 18px;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .vocal-region.selected .vocal-circle {
            border-color: var(--vocal-border);
        }

        .vocal-circle::after {
            content: '';
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
        }

        .vocal-region.selected .vocal-circle::after {
            background: var(--vocal-border);
        }

        /* Playhead */
        .playhead {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 2px;
            background: white;
            z-index: 100;
            pointer-events: none;
        }

        .playhead::before {
            content: '';
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            border-left: 7px solid transparent;
            border-right: 7px solid transparent;
            border-top: 10px solid white;
        }

        /* Timeline scrollbar area - Cubase style */
        .timeline-scroll-area {
            height: 16px;
            background: #1A1A1E;
            display: flex;
            align-items: center;
            padding: 0;
            border-top: 1px solid #2A2A30;
        }

        .timeline-scroll {
            flex: 1;
            height: 100%;
            background: #1A1A1E;
            position: relative;
            display: flex;
            align-items: center;
        }

        .timeline-scroll-thumb {
            position: absolute;
            left: 50px;
            width: 120px;
            height: 10px;
            background: linear-gradient(180deg, #5A5A62 0%, #3A3A42 100%);
            border-radius: 2px;
            border: 1px solid #6A6A72;
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.1);
            cursor: grab;
        }

        .timeline-scroll-thumb:hover {
            background: linear-gradient(180deg, #6A6A72 0%, #4A4A52 100%);
            border-color: #7A7A82;
        }

        .timeline-scroll-thumb:active {
            cursor: grabbing;
            background: linear-gradient(180deg, #7A7A82 0%, #5A5A62 100%);
        }

        /* Vertical Scrollbar (Right side) - Cubase style */
        .timeline-vertical-scroll {
            width: 16px;
            background: #1A1A1E;
            display: flex;
            flex-direction: column;
            align-items: center;
            border-left: 1px solid #2A2A30;
        }

        .vertical-scroll-track {
            flex: 1;
            width: 100%;
            position: relative;
            display: flex;
            justify-content: center;
            padding: 4px 0;
        }

        .vertical-scroll-thumb {
            position: absolute;
            top: 30px;
            width: 10px;
            height: 100px;
            background: linear-gradient(90deg, #5A5A62 0%, #3A3A42 100%);
            border-radius: 2px;
            border: 1px solid #6A6A72;
            box-shadow: inset 1px 0 0 rgba(255,255,255,0.1);
            cursor: grab;
        }

        .vertical-scroll-thumb:hover {
            background: linear-gradient(90deg, #6A6A72 0%, #4A4A52 100%);
            border-color: #7A7A82;
        }

        .vertical-scroll-thumb:active {
            cursor: grabbing;
            background: linear-gradient(90deg, #7A7A82 0%, #5A5A62 100%);
        }

        /* Scroll corner (intersection of H and V scrollbars) */
        .scroll-corner {
            width: 16px;
            height: 16px;
            background: #1A1A1E;
            flex-shrink: 0;
        }

        /* Detail Editor - Cubase Style */
        .detail-editor {
            background-color: var(--bg-main);
            display: flex;
            flex-direction: column;
            border-radius: var(--corner-radius-lg);
            overflow: hidden;
        }

        .detail-editor-header {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 36px;
            background: var(--bg-main);
            border-bottom: 1px solid #2A2D33;
            padding: 0 12px;
            position: relative;
        }

        .detail-editor-title {
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2.5px;
            color: #5A5D65;
            text-shadow:
                0 1px 0 rgba(200, 205, 215, 0.5),
                0 -1px 0 rgba(0, 0, 0, 0.7);
        }

        /* Edit Dock Tabs */
        .edit-dock-tabs {
            display: flex;
            align-items: flex-end;
            gap: 4px;
            height: 100%;
            position: absolute;
            left: 12px;
        }

        .edit-dock-tab {
            background: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            color: #808590;
            padding: 8px 16px;
            border-radius: 4px 4px 0 0;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.15s;
        }

        .edit-dock-tab:hover {
            color: #C0C6C5;
            background: rgba(255,255,255,0.03);
        }

        .edit-dock-tab.active {
            background: #3A3D45;
            color: #C0C6C5;
            border-bottom: 2px solid #4DFFFF;
        }

        .editor-tabs {
            display: none;
        }

        .editor-tab {
            background: transparent;
            border: none;
            color: var(--text-muted);
            padding: 6px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.15s;
        }

        .editor-tab:hover {
            color: var(--text-main);
            background: rgba(255,255,255,0.05);
        }

        .editor-tab.active {
            background: #2A2D35;
            color: var(--text-main);
        }

        /* Edit Dock Panels */
        .edit-dock-panel {
            display: none;
            flex: 1;
            flex-direction: column;
            overflow: hidden;
        }

        .edit-dock-panel.active {
            display: flex;
        }

        .empty-panel-placeholder {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #555;
            font-size: 18px;
            font-weight: 500;
            background: #1A1A20;
        }

        /* ==================== Step Sequencer Styles ==================== */
        /* Wrapper - Centers the neon box */
        .step-seq-wrapper {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #0D1117;
            padding: 15px;
        }

        /* Main Container - Outer Neon Border Box */
        .step-seq-container {
            display: flex;
            background: rgba(15, 20, 30, 0.9);
            border: 2px solid #4DFFFF;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(77, 255, 255, 0.4), inset 0 0 30px rgba(0, 0, 0, 0.5);
            padding: 10px;
            gap: 0;
        }

        /* Left - Track Headers */
        .step-seq-tracks {
            width: 150px;
            min-width: 150px;
            display: flex;
            flex-direction: column;
        }

        .step-seq-track-header {
            height: 56px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 4px 8px;
            margin-bottom: 4px;
            border-radius: 6px;
        }

        /* Track header backgrounds - darker version of track color */
        .step-seq-track-header[data-track="kick"] {
            background: rgba(255, 107, 107, 0.25);
            border-left: 3px solid #FF6B6B;
        }
        .step-seq-track-header[data-track="snare"] {
            background: rgba(77, 255, 255, 0.18);
            border-left: 3px solid #4DFFFF;
        }
        .step-seq-track-header[data-track="hihat"] {
            background: rgba(79, 210, 114, 0.25);
            border-left: 3px solid #4FD272;
        }
        .step-seq-track-header[data-track="perc"] {
            background: rgba(212, 95, 255, 0.22);
            border-left: 3px solid #D45FFF;
        }

        .smart-rand-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 42px;
            height: 42px;
            background: rgba(30, 35, 45, 0.9);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid rgba(77, 255, 255, 0.2);
        }

        .smart-rand-btn:hover {
            background: rgba(50, 55, 65, 0.9);
            box-shadow: 0 0 12px rgba(77, 255, 255, 0.4);
            border-color: #4DFFFF;
        }

        .smart-rand-btn .dice-icon {
            width: 28px;
            height: 28px;
            color: #4DFFFF;
        }

        .smart-rand-label {
            display: none;
        }

        .step-seq-track-name {
            font-size: 13px;
            font-weight: 600;
        }

        /* Add Track Button */
        .step-seq-add-track {
            height: 34px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .step-seq-add-track:hover .add-icon {
            text-shadow: 0 0 20px rgba(77, 255, 255, 0.9);
            transform: scale(1.1);
        }

        .step-seq-add-track .add-icon {
            font-size: 24px;
            font-weight: 300;
            color: #4DFFFF;
            text-shadow: 0 0 12px rgba(77, 255, 255, 0.6);
            line-height: 1;
            transition: all 0.2s ease;
        }

        /* Center - Grid Area with Inner Neon Border */
        .step-seq-grid-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #4DFFFF;
            border-radius: 6px;
            box-shadow: 0 0 10px rgba(77, 255, 255, 0.2);
            margin: 0 10px;
            overflow: hidden;
        }

        /* Ruler with tick marks */
        .step-seq-ruler {
            height: 28px;
            display: flex;
            align-items: flex-end;
            background: rgba(0, 0, 0, 0.4);
            border-bottom: 1px solid rgba(77, 255, 255, 0.3);
            padding: 0 6px;
        }

        .step-seq-ruler-beat {
            display: flex;
            align-items: flex-end;
            padding-right: 8px;
            margin-right: 8px;
            border-right: 1px solid rgba(77, 255, 255, 0.2);
        }

        .step-seq-ruler-beat:last-child {
            margin-right: 0;
            padding-right: 0;
            border-right: none;
        }

        .ruler-tick {
            width: 24px;
            height: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-right: 2px;
            position: relative;
        }

        .ruler-tick:last-child {
            margin-right: 0;
        }

        .ruler-tick .beat-label {
            font-size: 11px;
            font-weight: 600;
            color: #4DFFFF;
            text-shadow: 0 0 8px rgba(77, 255, 255, 0.5);
        }

        /* Grid container with scrollbars */
        .step-seq-grid-scroll {
            flex: 1;
            overflow: auto;
            padding: 6px;
            position: relative;
        }

        /* Pulse Visualizer - Center */
        .pulse-visualizer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 350px;
            height: 350px;
            pointer-events: none;
            z-index: 0;
            opacity: 0.5;
        }

        .pulse-visualizer svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 0 8px rgba(255, 100, 100, 0.5));
        }

        .pulse-ring {
            fill: none;
            stroke-width: 2;
            transform-origin: center;
        }

        .pulse-ring:nth-child(1) { stroke: #FF6B6B; }
        .pulse-ring:nth-child(2) { stroke: #FF8844; }
        .pulse-ring:nth-child(3) { stroke: #FFAA00; }
        .pulse-ring:nth-child(4) { stroke: #88DD44; }
        .pulse-ring:nth-child(5) { stroke: #4FD272; }
        .pulse-ring:nth-child(6) { stroke: #44DDAA; }
        .pulse-ring:nth-child(7) { stroke: #4DFFFF; }
        .pulse-ring:nth-child(8) { stroke: #44AAFF; }

        /* Pulse animation */
        @keyframes pulse-expand {
            0% { transform: scale(0.3); opacity: 1; }
            100% { transform: scale(1.2); opacity: 0; }
        }

        .pulse-visualizer.playing .pulse-ring {
            animation: pulse-expand 1.5s ease-out infinite;
        }

        .pulse-visualizer.playing .pulse-ring:nth-child(1) { animation-delay: 0s; }
        .pulse-visualizer.playing .pulse-ring:nth-child(2) { animation-delay: 0.1s; }
        .pulse-visualizer.playing .pulse-ring:nth-child(3) { animation-delay: 0.2s; }
        .pulse-visualizer.playing .pulse-ring:nth-child(4) { animation-delay: 0.3s; }
        .pulse-visualizer.playing .pulse-ring:nth-child(5) { animation-delay: 0.4s; }
        .pulse-visualizer.playing .pulse-ring:nth-child(6) { animation-delay: 0.5s; }
        .pulse-visualizer.playing .pulse-ring:nth-child(7) { animation-delay: 0.6s; }
        .pulse-visualizer.playing .pulse-ring:nth-child(8) { animation-delay: 0.7s; }

        .step-seq-grid {
            display: flex;
            flex-direction: column;
            gap: 4px;
            position: relative;
            z-index: 1;
        }

        .step-seq-row {
            height: 56px;
            display: flex;
            align-items: center;
            gap: 0;
            position: relative;
        }

        /* Beat group with separator */
        .step-beat-group {
            display: flex;
            gap: 2px;
            padding-right: 8px;
            margin-right: 8px;
            border-right: 1px solid rgba(77, 255, 255, 0.2);
            position: relative;
        }

        .step-beat-group:last-child {
            margin-right: 0;
            padding-right: 0;
            border-right: none;
        }

        /* Step cell - double border structure */
        .step-cell {
            width: 24px;
            height: 48px;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s ease;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            /* Outer border */
            border: 2px solid transparent;
            /* Inner border via box-shadow */
            box-shadow: inset 0 0 0 1px rgba(128, 128, 128, 0.25);
        }

        /* Inactive step - double border structure (outer + inner) */
        .step-seq-row[data-color="#FF6B6B"] .step-cell {
            border: 1px solid rgba(255, 107, 107, 0.35);
            box-shadow: inset 0 0 0 1px rgba(255, 107, 107, 0.15);
        }
        .step-seq-row[data-color="#4DFFFF"] .step-cell {
            border: 1px solid rgba(77, 255, 255, 0.35);
            box-shadow: inset 0 0 0 1px rgba(77, 255, 255, 0.15);
        }
        .step-seq-row[data-color="#4FD272"] .step-cell {
            border: 1px solid rgba(79, 210, 114, 0.35);
            box-shadow: inset 0 0 0 1px rgba(79, 210, 114, 0.15);
        }
        .step-seq-row[data-color="#D45FFF"] .step-cell {
            border: 1px solid rgba(212, 95, 255, 0.35);
            box-shadow: inset 0 0 0 1px rgba(212, 95, 255, 0.15);
        }

        .step-cell:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        /* Active step - Neon glow style with inner border */
        .step-seq-row[data-color="#FF6B6B"] .step-cell.active {
            background: rgba(255, 107, 107, 0.3);
            border: 2px solid #FF6B6B;
            box-shadow: 0 0 12px #FF6B6B, 0 0 20px rgba(255, 107, 107, 0.4), inset 0 0 0 3px rgba(0, 0, 0, 0.3), inset 0 0 0 4px rgba(255, 107, 107, 0.6);
        }

        .step-seq-row[data-color="#4DFFFF"] .step-cell.active {
            background: rgba(77, 255, 255, 0.3);
            border: 2px solid #4DFFFF;
            box-shadow: 0 0 12px #4DFFFF, 0 0 20px rgba(77, 255, 255, 0.4), inset 0 0 0 3px rgba(0, 0, 0, 0.3), inset 0 0 0 4px rgba(77, 255, 255, 0.6);
        }

        .step-seq-row[data-color="#4FD272"] .step-cell.active {
            background: rgba(79, 210, 114, 0.3);
            border: 2px solid #4FD272;
            box-shadow: 0 0 12px #4FD272, 0 0 20px rgba(79, 210, 114, 0.4), inset 0 0 0 3px rgba(0, 0, 0, 0.3), inset 0 0 0 4px rgba(79, 210, 114, 0.6);
        }

        .step-seq-row[data-color="#D45FFF"] .step-cell.active {
            background: rgba(212, 95, 255, 0.3);
            border: 2px solid #D45FFF;
            box-shadow: 0 0 12px #D45FFF, 0 0 20px rgba(212, 95, 255, 0.4), inset 0 0 0 3px rgba(0, 0, 0, 0.3), inset 0 0 0 4px rgba(212, 95, 255, 0.6);
        }

        /* Ghost step */
        .step-seq-row[data-color="#FF6B6B"] .step-cell.ghost {
            background: rgba(255, 107, 107, 0.08);
            box-shadow: inset 0 0 0 1px rgba(255, 107, 107, 0.3);
        }

        .step-seq-row[data-color="#4DFFFF"] .step-cell.ghost {
            background: rgba(77, 255, 255, 0.08);
            box-shadow: inset 0 0 0 1px rgba(77, 255, 255, 0.3);
        }

        .step-seq-row[data-color="#4FD272"] .step-cell.ghost {
            background: rgba(79, 210, 114, 0.08);
            box-shadow: inset 0 0 0 1px rgba(79, 210, 114, 0.3);
        }

        .step-seq-row[data-color="#D45FFF"] .step-cell.ghost {
            background: rgba(212, 95, 255, 0.08);
            box-shadow: inset 0 0 0 1px rgba(212, 95, 255, 0.3);
        }

        /* Ratchet label */
        .ratchet-label {
            position: absolute;
            top: 3px;
            font-size: 9px;
            font-weight: 700;
            color: #fff;
            text-shadow: 0 1px 3px rgba(0,0,0,0.7);
        }

        /* Custom scrollbar for grid */
        .step-seq-grid-scroll::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .step-seq-grid-scroll::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }

        .step-seq-grid-scroll::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #4DFFFF, #3AC9C9);
            border-radius: 4px;
        }

        .step-seq-grid-scroll::-webkit-scrollbar-corner {
            background: rgba(0, 0, 0, 0.3);
        }

        /* Right - Control Panel */
        .step-seq-controls {
            width: 90px;
            min-width: 90px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 5px;
            gap: 10px;
        }

        .kit-morph-btn {
            width: 70px;
            height: 60px;
            background: transparent;
            border: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .kit-morph-btn:hover .morph-icon {
            color: #fff;
            filter: drop-shadow(0 0 10px #4DFFFF) drop-shadow(0 0 20px #4DFFFF);
        }

        .kit-morph-btn:hover .kit-morph-label {
            color: #fff;
            text-shadow: 0 0 10px #4DFFFF, 0 0 20px #4DFFFF, 0 0 30px #4DFFFF;
        }

        .kit-morph-btn .morph-icon {
            width: 28px;
            height: 28px;
            color: #4DFFFF;
            transition: all 0.2s ease;
        }

        .kit-morph-label {
            font-size: 10px;
            color: #4DFFFF;
            margin-top: 3px;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .humanize-control {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .humanize-label {
            font-size: 11px;
            color: #C0C6D0;
            font-weight: 500;
        }

        .humanize-slider-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }

        .humanize-slider-track {
            width: 6px;
            height: 60px;
            background: rgba(30, 35, 45, 0.9);
            border-radius: 3px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(77, 255, 255, 0.2);
        }

        .humanize-slider-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(to top, #4DFFFF, #3AC9C9);
            border-radius: 3px;
            transition: height 0.2s ease;
        }

        .humanize-value {
            font-size: 11px;
            color: #4DFFFF;
            font-weight: 600;
        }

        /* Step count toggle button */
        .step-count-toggle {
            margin-top: auto;
            padding: 8px 12px;
            background: transparent;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
        }

        .step-count-toggle:hover .step-count-value,
        .step-count-toggle:hover .step-count-label {
            color: #fff;
            text-shadow: 0 0 10px #4DFFFF, 0 0 20px #4DFFFF, 0 0 30px #4DFFFF;
        }

        .step-count-toggle .step-count-value {
            font-size: 14px;
            font-weight: 700;
            color: #4DFFFF;
            transition: all 0.2s ease;
        }

        .step-count-toggle .step-count-label {
            font-size: 9px;
            color: #4DFFFF;
            text-transform: uppercase;
            transition: all 0.2s ease;
        }
        /* ==================== End Step Sequencer Styles ==================== */

        /* ==================== Mixer Panel Styles (FL Studio Style) ==================== */
        .mixer-wrapper {
            flex: 1;
            display: flex;
            background: #0D1117;
            padding: 10px;
        }

        .mixer-content {
            flex: 1;
            background: rgba(15, 20, 30, 0.9);
            border: 2px solid #4DFFFF;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(77, 255, 255, 0.4), inset 0 0 30px rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: stretch;
            padding: 10px 12px;
            overflow-x: auto;
            overflow-y: hidden;
            gap: 4px;
        }

        .mixer-content::-webkit-scrollbar { height: 8px; }
        .mixer-content::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.3); border-radius: 4px; }
        .mixer-content::-webkit-scrollbar-thumb { background: linear-gradient(90deg, #4DFFFF, #3AC9C9); border-radius: 4px; }

        /* Channel Strip - FL Studio Style (Slim) */
        .channel-strip {
            width: 52px;
            min-width: 52px;
            height: 100%;
            background: linear-gradient(180deg, rgba(40, 45, 55, 0.95), rgba(28, 32, 40, 0.95));
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0;
            position: relative;
            flex-shrink: 0;
            border: 1px solid rgba(77, 255, 255, 0.1);
            transition: all 0.2s ease;
            overflow: visible;
        }

        .channel-strip:hover {
            border-color: rgba(77, 255, 255, 0.4);
            box-shadow: 0 0 12px rgba(77, 255, 255, 0.15);
        }

        .channel-strip.selected {
            border-color: rgba(77, 255, 255, 0.6);
            box-shadow: 0 0 15px rgba(77, 255, 255, 0.3), inset 0 0 20px rgba(77, 255, 255, 0.05);
        }

        .channel-strip.master-strip {
            width: 58px;
            min-width: 58px;
            background: linear-gradient(180deg, rgba(50, 45, 35, 0.95), rgba(35, 32, 25, 0.95));
            border-color: rgba(255, 215, 0, 0.25);
        }

        .channel-strip.master-strip:hover {
            border-color: rgba(255, 215, 0, 0.5);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
        }

        .channel-strip.master-strip.selected {
            border-color: rgba(255, 215, 0, 0.7);
            box-shadow: 0 0 18px rgba(255, 215, 0, 0.4), inset 0 0 20px rgba(255, 215, 0, 0.05);
        }

        /* Track Name Header (  + ) */
        .mixer-track-header {
            width: 100%;
            height: 70px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            position: relative;
            padding-top: 4px;
        }

        .mixer-color-bar {
            width: 100%;
            height: 3px;
            margin-bottom: 6px;
        }

        .mixer-track-name-vertical {
            writing-mode: vertical-rl;
            text-orientation: mixed;
            transform: rotate(180deg);
            font-size: 10px;
            font-weight: 600;
            color: #ddd;
            letter-spacing: 1px;
            text-transform: uppercase;
            max-height: 55px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Control Buttons Row */
        .mixer-controls-row {
            display: flex;
            gap: 4px;
            padding: 4px 0;
        }

        .btn-mixer-ctrl {
            width: 20px;
            height: 18px;
            font-size: 10px;
            font-weight: 700;
            background: transparent;
            color: #555;
            border: 1px solid #444;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-mixer-ctrl:hover {
            border-color: #666;
            color: #888;
        }

        .btn-mixer-ctrl.active-mute {
            background: transparent;
            color: #FFB800;
            border-color: #FFB800;
            box-shadow: 0 0 8px rgba(255, 184, 0, 0.6), 0 0 16px rgba(255, 184, 0, 0.3);
            text-shadow: 0 0 8px #FFB800;
        }

        .btn-mixer-ctrl.active-solo {
            background: transparent;
            color: #4FD272;
            border-color: #4FD272;
            box-shadow: 0 0 8px rgba(79, 210, 114, 0.6), 0 0 16px rgba(79, 210, 114, 0.3);
            text-shadow: 0 0 8px #4FD272;
        }

        /* Fader + Level Meter Area (FL Studio Core) */
        .mixer-fader-section {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: stretch;
            gap: 3px;
            padding: 6px 2px;
            width: 100%;
            overflow: visible;
        }

        /* Level Meter ( ) */
        .level-meter {
            width: 6px;
            height: 100%;
            background: #1a1a20;
            border-radius: 2px;
            position: relative;
            overflow: hidden;
            border: 1px solid #333;
        }

        .level-meter-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(to top,
                #FF00FF 0%,
                #AA00FF 35%,
                #8B00FF 55%,
                #00CCFF 80%,
                #00FFFF 100%);
            border-radius: 1px;
            transition: height 0.1s ease;
            box-shadow: 0 0 6px rgba(170, 0, 255, 0.5);
        }

        /* Fader () */
        .mixer-fader-track {
            width: 6px;
            height: 100%;
            background: linear-gradient(180deg, #252530, #1a1a20);
            border-radius: 3px;
            position: relative;
            border: 1px solid #3a3a45;
            overflow: visible;
        }

        .mixer-fader-thumb {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 22px;
            height: 18px;
            background: linear-gradient(180deg, #666, #444);
            border-radius: 2px;
            cursor: grab;
            border: 1px solid #888;
            box-shadow: 0 0 6px var(--fader-color, rgba(77, 255, 255, 0.3));
            z-index: 5;
        }

        .mixer-fader-thumb::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 16px;
            height: 1px;
            background: var(--fader-color, #4DFFFF);
            box-shadow: 0 -3px 0 var(--fader-color, #4DFFFF), 0 3px 0 var(--fader-color, #4DFFFF);
            opacity: 0.9;
        }

        /* Volume Display */
        .mixer-vol-display {
            width: 100%;
            text-align: center;
            padding: 4px 0 6px 0;
            font-size: 9px;
            font-family: 'Consolas', monospace;
            color: #4DFFFF;
            background: rgba(0, 0, 0, 0.3);
        }

        .master-strip .mixer-vol-display {
            color: #FFD700;
        }

        /* Separator */
        .mixer-separator {
            width: 1px;
            height: 100%;
            background: linear-gradient(180deg, transparent 5%, rgba(255, 215, 0, 0.3) 50%, transparent 95%);
            margin: 0 4px;
            flex-shrink: 0;
        }

        /* Master specific */
        .master-strip .mixer-track-name-vertical {
            color: #FFD700;
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
        }

        /* FX Channel */
        .fx-strip {
            background: linear-gradient(180deg, rgba(60, 40, 50, 0.95), rgba(40, 28, 35, 0.95));
            border-color: rgba(255, 107, 157, 0.2);
        }

        .fx-strip:hover {
            border-color: rgba(255, 107, 157, 0.5);
            box-shadow: 0 0 12px rgba(255, 107, 157, 0.2);
        }

        .fx-strip.selected {
            border-color: rgba(255, 107, 157, 0.7);
            box-shadow: 0 0 15px rgba(255, 107, 157, 0.4), inset 0 0 20px rgba(255, 107, 157, 0.05);
        }

        .fx-strip .mixer-track-name-vertical {
            color: #FF6B9D;
            text-shadow: 0 0 6px rgba(255, 107, 157, 0.5);
        }

        /* Group Channel */
        .group-strip {
            background: linear-gradient(180deg, rgba(30, 50, 60, 0.95), rgba(20, 35, 45, 0.95));
            border-color: rgba(0, 191, 255, 0.2);
        }

        .group-strip:hover {
            border-color: rgba(0, 191, 255, 0.5);
            box-shadow: 0 0 12px rgba(0, 191, 255, 0.2);
        }

        .group-strip.selected {
            border-color: rgba(0, 191, 255, 0.7);
            box-shadow: 0 0 15px rgba(0, 191, 255, 0.4), inset 0 0 20px rgba(0, 191, 255, 0.05);
        }

        .group-strip .mixer-track-name-vertical {
            color: #00BFFF;
            text-shadow: 0 0 6px rgba(0, 191, 255, 0.5);
        }

        /* AI Smart Knob */
        .smart-knob-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 4px 0;
            margin-bottom: 2px;
        }

        .smart-knob {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #3a3a45, #1a1a20);
            border: 2px solid #444;
            position: relative;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
        }

        .smart-knob:hover {
            border-color: var(--knob-color, #4DFFFF);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5), 0 0 10px var(--knob-color, rgba(77, 255, 255, 0.3));
        }

        .smart-knob.active {
            border-color: var(--knob-color, #4DFFFF);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5), 0 0 12px var(--knob-color, rgba(77, 255, 255, 0.5));
        }

        .smart-knob-indicator {
            position: absolute;
            top: 3px;
            left: 50%;
            width: 2px;
            height: 8px;
            background: #555;
            transform-origin: bottom center;
            transform: translateX(-50%) rotate(var(--knob-rotation, 0deg));
            border-radius: 1px;
            transition: background 0.2s ease;
        }

        .smart-knob:hover .smart-knob-indicator,
        .smart-knob.active .smart-knob-indicator {
            background: var(--knob-color, #4DFFFF);
            box-shadow: 0 0 4px var(--knob-color, #4DFFFF);
        }

        .smart-knob-label {
            font-size: 7px;
            font-weight: 700;
            color: #666;
            margin-top: 3px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.2s ease;
        }

        .smart-knob-wrapper:hover .smart-knob-label {
            color: var(--knob-color, #4DFFFF);
            text-shadow: 0 0 6px var(--knob-color, rgba(77, 255, 255, 0.5));
        }

        .smart-knob.active + .smart-knob-label {
            color: var(--knob-color, #4DFFFF);
            text-shadow: 0 0 6px var(--knob-color, rgba(77, 255, 255, 0.5));
        }

        /* Smart Knob Value Display (on hover) */
        .smart-knob-value {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 9px;
            font-weight: 600;
            color: var(--knob-color, #4DFFFF);
            background: rgba(0, 0, 0, 0.8);
            padding: 2px 5px;
            border-radius: 3px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
            white-space: nowrap;
        }

        .smart-knob-wrapper:hover .smart-knob-value {
            opacity: 1;
        }
        /* ==================== End Mixer Panel Styles ==================== */

        .editor-content {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        /* AI Modifier Panel */
        .ai-modifier {
            width: 120px;
            background: #252830;
            padding: 12px;
            border-right: 1px solid #2A2D33;
            flex-shrink: 0;
        }

        .modifier-title {
            color: var(--neon-cyan);
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .slider-group {
            margin-bottom: 12px;
        }

        .slider-label {
            color: var(--text-muted);
            font-size: 10px;
            margin-bottom: 4px;
        }

        .slider-bar {
            height: 6px;
            background: #1A1A20;
            border-radius: 3px;
            overflow: hidden;
        }

        .slider-fill {
            height: 100%;
            background: var(--track-bass);
            border-radius: 3px;
        }

        /* Piano Roll Container */
        .piano-roll {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Piano Roll Time Ruler */
        .piano-roll-ruler {
            height: 24px;
            display: flex;
            background: #1A1A20;
            border-bottom: 1px solid #3A3D45;
            flex-shrink: 0;
        }

        .piano-roll-ruler-corner {
            width: 65px;
            background: #1A1A20;
            border-right: 1px solid #2A2D33;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .midi-clip-name {
            font-size: 9px;
            color: #E85D5D;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .piano-roll-ruler-content {
            flex: 1;
            position: relative;
            overflow: hidden;
            background:
                repeating-linear-gradient(
                    90deg,
                    transparent 0px,
                    transparent 24px,
                    #252830 24px,
                    #252830 25px
                ),
                repeating-linear-gradient(
                    90deg,
                    transparent 0px,
                    transparent 99px,
                    #3A3D45 99px,
                    #3A3D45 100px
                );
        }

        .piano-roll-bar-marker {
            position: absolute;
            top: 4px;
            font-size: 10px;
            font-weight: 500;
            color: #808590;
        }

        .piano-roll-bar-marker .bar-beat {
            color: #606570;
            margin-left: 2px;
        }

        .piano-roll-beat-marker {
            position: absolute;
            top: 4px;
            font-size: 9px;
            color: #505560;
        }

        /* Piano Roll Body */
        .piano-roll-body {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        /* Piano Keys - Cubase Style (Real Piano Layout) */
        .piano-keys {
            width: 65px;
            background: #1A1A20;
            flex-shrink: 0;
            position: relative;
            border-right: 1px solid #2A2D33;
            overflow: hidden;
        }

        /* White keys - full height, sequential */
        .piano-key-white {
            position: absolute;
            left: 0;
            width: 100%;
            background: linear-gradient(90deg, #909090 0%, #C8C8C8 40%, #E0E0E0 60%, #D0D0D0 100%);
            border-bottom: 1px solid #707070;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 3px;
            font-size: 8px;
            color: #404040;
            box-sizing: border-box;
            z-index: 1;
        }

        .piano-key-white.c-key {
            font-weight: bold;
        }

        /* Black keys - shorter, overlay on white keys */
        .piano-key-black {
            position: absolute;
            left: 0;
            width: 65%;
            background: linear-gradient(90deg, #101010 0%, #252525 50%, #1A1A1A 100%);
            border-radius: 0 2px 2px 0;
            box-shadow: 2px 0 3px rgba(0,0,0,0.5);
            z-index: 2;
        }

        /* MIDI Grid Area */
        .midi-grid-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .midi-grid {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: #252830;
        }

        /* Grid Lines */
        .midi-grid-lines {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            background:
                /* Bar lines (100px) - bright */
                repeating-linear-gradient(
                    90deg,
                    transparent 0px,
                    transparent 99px,
                    #404550 99px,
                    #404550 100px
                ),
                /* Beat lines (25px) - subtle */
                repeating-linear-gradient(
                    90deg,
                    transparent 0px,
                    transparent 24px,
                    #2A2D35 24px,
                    #2A2D35 25px
                );
        }

        /* Horizontal row backgrounds for piano keys - Cubase Style */
        .midi-grid-rows {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
        }

        .midi-row {
            position: absolute;
            left: 0;
            right: 0;
            height: 14px;
            border-bottom: 1px solid #1E2028;
        }

        .midi-row.white-key {
            background: #2A2D35;
        }

        .midi-row.black-key {
            background: #1E2128;
        }

        .midi-row.c-row {
            border-bottom: 1px solid #3A3D45;
        }

        /* MIDI Notes - Cubase Red Style */
        .midi-note {
            position: absolute;
            height: 14px;
            background: linear-gradient(180deg, #E85D5D 0%, #C94545 100%);
            border-radius: 2px;
            border: 1px solid #FF7070;
            box-shadow: 0 1px 2px rgba(0,0,0,0.3);
            cursor: pointer;
            display: flex;
            align-items: center;
            padding-left: 4px;
            font-size: 9px;
            color: rgba(255,255,255,0.9);
            font-weight: 500;
            overflow: hidden;
        }

        .midi-note:hover {
            background: linear-gradient(180deg, #FF6B6B 0%, #D55050 100%);
            border-color: #FF8080;
        }

        .midi-note.selected {
            background: linear-gradient(180deg, #FF7070 0%, #E05555 100%);
            border-color: #FFAAAA;
            box-shadow: 0 0 6px rgba(255,100,100,0.5);
        }

        /* Velocity Lane - Cubase Style (Below Piano Roll) */
        .velocity-section {
            height: 70px;
            background: #1A1A20;
            border-top: 1px solid #3A3D45;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .velocity-lane {
            flex: 1;
            display: flex;
            background: #1A1A20;
        }

        .velocity-header {
            width: 65px;
            display: flex;
            flex-direction: column;
            background: #1A1A20;
            border-right: 1px solid #2A2D33;
        }

        .velocity-label-area {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: var(--text-muted);
        }

        .velocity-grid {
            flex: 1;
            position: relative;
            background:
                repeating-linear-gradient(
                    90deg,
                    transparent 0px,
                    transparent 99px,
                    #2A2D35 99px,
                    #2A2D35 100px
                ),
                repeating-linear-gradient(
                    90deg,
                    transparent 0px,
                    transparent 24px,
                    #1F2228 24px,
                    #1F2228 25px
                ),
                #1A1A20;
        }

        .velocity-max-label {
            width: 35px;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding-top: 4px;
            font-size: 10px;
            color: #606570;
            background: #1A1A20;
        }

        .velocity-bar {
            position: absolute;
            bottom: 0;
            width: 6px;
            background: linear-gradient(180deg, #E85D5D 0%, #B84040 100%);
            border-radius: 1px 1px 0 0;
        }

        /* Velocity Bottom Controls - Cubase Style */
        .velocity-bottom-bar {
            height: 22px;
            display: flex;
            background: #252830;
            border-top: 1px solid #2A2D33;
        }

        .velocity-controls-left {
            width: 65px;
            display: flex;
            align-items: center;
            padding: 0 4px;
            gap: 4px;
            border-right: 1px solid #2A2D33;
        }

        .velocity-add-btn {
            width: 18px;
            height: 16px;
            background: #3A3D45;
            border: 1px solid #4A4D55;
            border-radius: 2px;
            color: #909090;
            font-size: 14px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .velocity-add-btn:hover {
            background: #4A4D55;
            color: #C0C0C0;
        }

        .velocity-dropdown-btn {
            width: 18px;
            height: 16px;
            background: #3A3D45;
            border: 1px solid #4A4D55;
            border-radius: 2px;
            color: #909090;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .velocity-dropdown-btn:hover {
            background: #4A4D55;
            color: #C0C0C0;
        }

        /* Piano Roll Scrollbar - Cubase Style */
        .piano-roll-scrollbar {
            flex: 1;
            display: flex;
            align-items: center;
            padding: 0 8px;
            background: #1A1A1E;
        }

        .piano-roll-scroll-track {
            flex: 1;
            height: 10px;
            background: #101015;
            border-radius: 2px;
            position: relative;
        }

        .piano-roll-scroll-thumb {
            position: absolute;
            left: 10%;
            width: 25%;
            height: 100%;
            background: linear-gradient(180deg, #5A5A62 0%, #3A3A42 100%);
            border-radius: 2px;
            border: 1px solid #6A6A72;
            cursor: grab;
        }

        .piano-roll-scroll-thumb:hover {
            background: linear-gradient(180deg, #6A6A72 0%, #4A4A52 100%);
        }

        /* Piano Roll Playhead */
        .piano-roll-playhead {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 1px;
            background: #FFFFFF;
            z-index: 50;
            pointer-events: none;
        }

        .piano-roll-playhead::before {
            content: '';
            position: absolute;
            top: -24px;
            left: -5px;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-top: 8px solid #FFFFFF;
        }

        /* AI Copilot (Right Sidebar) */
        .ai-copilot {
            background-color: var(--bg-main);
            display: flex;
            flex-direction: column;
            padding: 0 15px 15px 15px;
            border-radius: var(--corner-radius-lg);
        }

        .copilot-title {
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2.5px;
            color: #5A5D65;
            text-shadow:
                0 1px 0 rgba(200, 205, 215, 0.5),
                0 -1px 0 rgba(0, 0, 0, 0.7);
            text-align: center;
            padding: 6px 0;
            border-bottom: 1px solid #2A2D33;
            margin-bottom: 15px;
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
        }

        .chat-bubble {
            border-radius: var(--corner-radius);
            padding: 12px;
            margin-bottom: 10px;
            font-size: 12px;
        }

        .chat-bubble.user {
            background: var(--chat-user);
        }

        .chat-bubble.ai {
            background: var(--chat-ai);
        }

        .chat-sender {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .chat-input-area {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .chat-input {
            flex: 1;
            background: var(--bg-input);
            border: 1px solid var(--bg-panel);
            border-radius: var(--corner-radius);
            color: var(--text-main);
            padding: 10px;
            font-size: 12px;
        }

        .chat-input::placeholder {
            color: var(--text-muted);
        }

        .send-btn {
            background: var(--neon-cyan);
            border: none;
            color: var(--bg-main);
            width: 35px;
            height: 35px;
            border-radius: var(--corner-radius);
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <span class="project-name">Rain-Fi</span>
                <div class="undo-redo-group">
                    <button class="undo-redo-btn" title="Undo">
                        <svg viewBox="0 0 24 24">
                            <path d="M3 9h10c3.5 0 6 2.5 6 6s-2.5 6-6 6H8"/>
                            <polyline points="7 5 3 9 7 13"/>
                        </svg>
                    </button>
                    <button class="undo-redo-btn" title="Redo">
                        <svg viewBox="0 0 24 24">
                            <path d="M21 9H11c-3.5 0-6 2.5-6 6s2.5 6 6 6h5"/>
                            <polyline points="17 5 21 9 17 13"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="header-center">
                <div class="transport-group">
                    <button class="transport-btn play-btn">
                        <div class="play-icon"></div>
                    </button>
                    <button class="transport-btn stop-btn">
                        <div class="stop-icon"></div>
                    </button>
                    <button class="rec-btn">
                        <div class="circle"></div>
                    </button>
                    <div class="transport-divider"></div>
                    <div class="tempo-box">
                        <span class="bpm-value">120 BPM</span>
                        <span class="key-display">Key: C Major</span>
                    </div>
                </div>
            </div>
            <div class="header-right">
                <button class="magic-mix-btn">Magic Mix</button>
                <button class="export-btn">Export</button>
                <button class="icon-btn" title="Mixer">
                    <div class="mixer-icon">
                        <div class="mixer-bar"></div>
                        <div class="mixer-bar"></div>
                        <div class="mixer-bar"></div>
                        <div class="mixer-bar"></div>
                    </div>
                </button>
                <button class="icon-btn" title="Project Meta">
                    <div class="disc-icon"></div>
                </button>
            </div>
        </header>

        <!-- Resource Browser -->
        <aside class="resource-browser">
            <div class="sidebar-section">
                <div class="section-title">AI Generate</div>
                <div class="ai-generate-box">
                    <div class="desc">Describe the music you want to create</div>
                    <textarea class="prompt-input" placeholder="Enter prompt...">Rainy day lo-fi hip-hop</textarea>
                    <button class="generate-btn">Generate</button>
                    <div style="clear: both;"></div>
                </div>
            </div>
            <div class="sidebar-section">
                <div class="menu-item">Instruments</div>
                <div class="menu-item">My Samples</div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Timeline -->
            <section class="timeline">
                <!-- Timeline Header -->
                <div class="timeline-header">
                    <span class="timeline-title">Timeline View</span>
                </div>

                <!-- Timeline Body (Split Layout) -->
                <div class="timeline-body">
                    <!-- Left Panel: Track Headers -->
                    <div class="track-headers-panel" id="trackHeadersPanel">
                        <!-- Time Ruler Header -->
                        <div class="time-ruler">
                            <div class="time-ruler-header">
                                <button class="expand-tracks-btn" onclick="toggleAllTracksExpand()" title="Expand/Collapse Track Controls">
                                    <div class="expand-bar"></div>
                                    <div class="expand-bar"></div>
                                    <div class="expand-bar"></div>
                                    <div class="expand-arrow"></div>
                                </button>
                            </div>
                        </div>

                        <!-- Track Headers List -->
                        <div class="track-headers-list">
                            <!-- Chord Track Header -->
                            <div class="track-header-row">
                                <div class="track-header-box">
                                    <div class="track-color-bar chord"></div>
                                    <span class="track-name">Chord</span>
                                    <div class="track-controls">
                                        <div class="track-knob-group">
                                            <div class="track-knob volume"></div>
                                            <span class="track-knob-label">Vol</span>
                                        </div>
                                        <div class="track-knob-group">
                                            <div class="track-knob pan"></div>
                                            <span class="track-knob-label">Pan</span>
                                        </div>
                                        <button class="track-btn mute">M</button>
                                        <button class="track-btn solo">S</button>
                                        <button class="track-btn rec">R</button>
                                    </div>
                                    <div class="track-menu">
                                        <div class="track-menu-dot"></div>
                                        <div class="track-menu-dot"></div>
                                        <div class="track-menu-dot"></div>
                                        <div class="track-menu-dot"></div>
                                        <div class="track-menu-dot"></div>
                                        <div class="track-menu-dot"></div>
                                    </div>
                                </div>
                            </div>
                            <!-- Drums Header -->
                            <div class="track-header-row">
                                <div class="track-header-box selected">
                                    <div class="track-color-bar drums"></div>
                                    <span class="track-name">Drums</span>
                                    <div class="track-controls">
                                        <!-- Volume Knob -->
                                        <div class="track-knob-group">
                                            <div class="track-knob volume"></div>
                                            <span class="track-knob-label">Vol</span>
                                        </div>
                                        <!-- Pan Knob -->
                                        <div class="track-knob-group">
                                            <div class="track-knob pan"></div>
                                            <span class="track-knob-label">Pan</span>
                                        </div>
                                        <!-- Control Buttons -->
                                        <button class="track-btn mute">M</button>
                                        <button class="track-btn solo active">S</button>
                                        <button class="track-btn rec">R</button>
                                    </div>
                                    <div class="track-menu">
                                        <div class="track-menu-dot"></div>
                                        <div class="track-menu-dot"></div>
                                        <div class="track-menu-dot"></div>
                                        <div class="track-menu-dot"></div>
                                        <div class="track-menu-dot"></div>
                                        <div class="track-menu-dot"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Bass Header -->
                            <div class="track-header-row">
                                <div class="track-header-box">
                                    <div class="track-color-bar bass"></div>
                                    <span class="track-name">Bass</span>
                                    <div class="track-controls">
                                        <div class="track-knob-group">
                                            <div class="track-knob volume"></div>
                                            <span class="track-knob-label">Vol</span>
                                        </div>
                                        <div class="track-knob-group">
                                            <div class="track-knob pan"></div>
                                            <span class="track-knob-label">Pan</span>
                                        </div>
                                        <button class="track-btn mute">M</button>
                                        <button class="track-btn solo">S</button>
                                        <button class="track-btn rec">R</button>
                                    </div>
                                    <div class="track-menu">
                                        <div class="track-menu-dot"></div>
                                        <div class="track-menu-dot"></div>
                                        <div class="track-menu-dot"></div>
                                        <div class="track-menu-dot"></div>
                                        <div class="track-menu-dot"></div>
                                        <div class="track-menu-dot"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Piano Header -->
                            <div class="track-header-row">
                                <div class="track-header-box">
                                    <div class="track-color-bar piano"></div>
                                    <span class="track-name">Piano</span>
                                    <div class="track-controls">
                                        <div class="track-knob-group">
                                            <div class="track-knob volume"></div>
                                            <span class="track-knob-label">Vol</span>
                                        </div>
                                        <div class="track-knob-group">
                                            <div class="track-knob pan"></div>
                                            <span class="track-knob-label">Pan</span>
                                        </div>
                                        <button class="track-btn mute">M</button>
                                        <button class="track-btn solo">S</button>
                                        <button class="track-btn rec">R</button>
                                    </div>
                                    <div class="track-menu">
                                        <div class="track-menu-dot"></div>
                                        <div class="track-menu-dot"></div>
                                        <div class="track-menu-dot"></div>
                                        <div class="track-menu-dot"></div>
                                        <div class="track-menu-dot"></div>
                                        <div class="track-menu-dot"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Vocal Header -->
                            <div class="track-header-row">
                                <div class="track-header-box">
                                    <div class="track-color-bar vocal"></div>
                                    <span class="track-name">Vocal</span>
                                    <div class="track-controls">
                                        <div class="track-knob-group">
                                            <div class="track-knob volume"></div>
                                            <span class="track-knob-label">Vol</span>
                                        </div>
                                        <div class="track-knob-group">
                                            <div class="track-knob pan"></div>
                                            <span class="track-knob-label">Pan</span>
                                        </div>
                                        <button class="track-btn mute">M</button>
                                        <button class="track-btn solo">S</button>
                                        <button class="track-btn rec">R</button>
                                    </div>
                                    <div class="track-menu">
                                        <div class="track-menu-dot"></div>
                                        <div class="track-menu-dot"></div>
                                        <div class="track-menu-dot"></div>
                                        <div class="track-menu-dot"></div>
                                        <div class="track-menu-dot"></div>
                                        <div class="track-menu-dot"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Resize Divider -->
                    <div class="timeline-divider" id="timelineDivider"></div>

                    <!-- Right Panel: Track Content -->
                    <div class="track-content-panel">
                        <!-- Time Ruler Content (100px = 1 bar, 25px = 1 beat) -->
                        <div class="time-ruler">
                            <div class="time-ruler-content" id="timeRulerContent">
                                <!-- Generated dynamically by JavaScript -->
                            </div>
                        </div>

                        <!-- Track Content List -->
                        <div class="track-content-list">
                            <!-- Playhead -->
                            <div class="playhead" style="left: 530px;"></div>

                            <!-- Chord Track Content -->
                            <div class="track-content-row chord-track-content">
                                <div class="chord-block" style="left: 10px; width: 100px;">Am7</div>
                                <div class="chord-block selected" style="left: 165px; width: 100px;">D7</div>
                                <div class="chord-block" style="left: 320px; width: 180px;">Gmaj7</div>
                                <div class="chord-block" style="left: 510px; width: 190px;">Cmaj7</div>
                            </div>

                            <!-- Drums Content -->
                            <div class="track-content-row">
                                <div class="track-region drums-region" style="left: 50px; width: 150px;">
                                    <span class="region-label">Drums</span>
                                    <div class="drum-pattern">
                                        <div class="drum-hit" style="height: 12px;"></div>
                                        <div class="drum-hit" style="height: 18px;"></div>
                                        <div class="drum-hit" style="height: 8px;"></div>
                                        <div class="drum-hit" style="height: 15px;"></div>
                                        <div class="drum-hit" style="height: 12px;"></div>
                                        <div class="drum-hit" style="height: 18px;"></div>
                                        <div class="drum-hit" style="height: 10px;"></div>
                                        <div class="drum-hit" style="height: 14px;"></div>
                                    </div>
                                </div>
                                <div class="track-region drums-region" style="left: 210px; width: 30px;"></div>
                                <div class="track-region drums-region" style="left: 250px; width: 30px;"></div>
                                <div class="track-region drums-region" style="left: 290px; width: 30px;"></div>
                                <div class="track-region drums-region" style="left: 330px; width: 30px;"></div>
                                <div class="track-region drums-region selected" style="left: 400px; width: 120px;">
                                    <span class="region-label">Drums</span>
                                    <div class="drum-pattern">
                                        <div class="drum-hit" style="height: 10px;"></div>
                                        <div class="drum-hit" style="height: 16px;"></div>
                                        <div class="drum-hit" style="height: 12px;"></div>
                                        <div class="drum-hit" style="height: 14px;"></div>
                                        <div class="drum-hit" style="height: 18px;"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Bass Content -->
                            <div class="track-content-row">
                                <div class="track-region bass-region selected" style="left: 100px; width: 130px;">
                                    <span class="region-label">Bass</span>
                                    <div class="waveform">
                                        <div class="wave-bar" style="height: 8px;"></div>
                                        <div class="wave-bar" style="height: 12px;"></div>
                                        <div class="wave-bar" style="height: 6px;"></div>
                                        <div class="wave-bar" style="height: 14px;"></div>
                                        <div class="wave-bar" style="height: 10px;"></div>
                                        <div class="wave-bar" style="height: 8px;"></div>
                                        <div class="wave-bar" style="height: 12px;"></div>
                                    </div>
                                </div>
                                <div class="track-region bass-region" style="left: 250px; width: 100px;">
                                    <span class="region-label">Bass</span>
                                    <div class="waveform">
                                        <div class="wave-bar" style="height: 10px;"></div>
                                        <div class="wave-bar" style="height: 14px;"></div>
                                        <div class="wave-bar" style="height: 8px;"></div>
                                        <div class="wave-bar" style="height: 12px;"></div>
                                    </div>
                                </div>
                                <div class="track-region bass-region" style="left: 370px; width: 150px;">
                                    <span class="region-label">Bass</span>
                                    <div class="waveform">
                                        <div class="wave-bar" style="height: 6px;"></div>
                                        <div class="wave-bar" style="height: 10px;"></div>
                                        <div class="wave-bar" style="height: 14px;"></div>
                                        <div class="wave-bar" style="height: 8px;"></div>
                                        <div class="wave-bar" style="height: 12px;"></div>
                                        <div class="wave-bar" style="height: 10px;"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Piano Content -->
                            <div class="track-content-row">
                                <div class="track-region piano-region selected" style="left: 165px; width: 160px;">
                                    <span class="region-label">Piano</span>
                                    <div class="waveform">
                                        <div class="wave-bar" style="height: 4px;"></div>
                                        <div class="wave-bar" style="height: 8px;"></div>
                                        <div class="wave-bar" style="height: 6px;"></div>
                                        <div class="wave-bar" style="height: 10px;"></div>
                                        <div class="wave-bar" style="height: 4px;"></div>
                                        <div class="wave-bar" style="height: 8px;"></div>
                                    </div>
                                </div>
                                <div class="track-region piano-region" style="left: 400px; width: 120px;">
                                    <span class="region-label">Piano</span>
                                    <div class="waveform">
                                        <div class="wave-bar" style="height: 6px;"></div>
                                        <div class="wave-bar" style="height: 10px;"></div>
                                        <div class="wave-bar" style="height: 8px;"></div>
                                        <div class="wave-bar" style="height: 12px;"></div>
                                    </div>
                                </div>
                                <div class="auto-fill-region" style="left: 530px; width: 100px;">
                                    <div class="auto-fill-label">
                                        <span class="auto-fill-arrow"></span>
                                        <span>Auto-fill</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Vocal Content -->
                            <div class="track-content-row">
                                <div class="track-region vocal-region selected" style="left: 540px; width: 130px;">
                                    <span class="region-label">Vocal</span>
                                    <div class="vocal-circle"></div>
                                    <div class="vocal-waveform" style="left: 40px;">
                                        <div class="vocal-wave" style="height: 4px;"></div>
                                        <div class="vocal-wave" style="height: 8px;"></div>
                                        <div class="vocal-wave" style="height: 12px;"></div>
                                        <div class="vocal-wave" style="height: 6px;"></div>
                                        <div class="vocal-wave" style="height: 10px;"></div>
                                        <div class="vocal-wave" style="height: 4px;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Timeline Scrollbar Area -->
                        <div class="timeline-scroll-area">
                            <div class="timeline-scroll">
                                <div class="timeline-scroll-thumb"></div>
                            </div>
                            <div class="scroll-corner"></div>
                        </div>
                    </div>

                    <!-- Vertical Scrollbar (Right side) -->
                    <div class="timeline-vertical-scroll">
                        <div class="vertical-scroll-track">
                            <div class="vertical-scroll-thumb"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Detail Editor - Cubase Style Piano Roll -->
            <section class="detail-editor">
                <div class="detail-editor-header">
                    <span class="detail-editor-title">Edit Dock</span>
                    <div class="edit-dock-tabs">
                        <button class="edit-dock-tab active">Step Seq</button>
                        <button class="edit-dock-tab">Piano Roll</button>
                        <button class="edit-dock-tab">Mixer</button>
                        <button class="edit-dock-tab">Audio</button>
                        <button class="edit-dock-tab">Sampler</button>
                    </div>
                </div>
                <!-- Tab Panels -->
                <!-- Step Seq Panel -->
                <div class="edit-dock-panel active" data-panel="step-seq">
                    <div class="step-seq-wrapper">
                        <div class="step-seq-container">
                            <!-- Left - Track Headers -->
                            <div class="step-seq-tracks">
                            <!-- Add Track Button () -->
                            <div class="step-seq-add-track" title="Add Track">
                                <span class="add-icon">+</span>
                            </div>
                            <!-- Kick Track -->
                            <div class="step-seq-track-header" data-track="kick">
                                <div class="smart-rand-btn" title="Smart Randomize">
                                    <svg viewBox="0 0 24 24" class="dice-icon">
                                        <rect x="3" y="3" width="18" height="18" rx="3" fill="none" stroke="currentColor" stroke-width="2"/>
                                        <circle cx="8" cy="8" r="1.5" fill="currentColor"/>
                                        <circle cx="12" cy="12" r="1.5" fill="currentColor"/>
                                        <circle cx="16" cy="16" r="1.5" fill="currentColor"/>
                                    </svg>
                                    <span class="smart-rand-label">Smart Rand</span>
                                </div>
                                <span class="step-seq-track-name" style="color: #FF6B6B;">Kick</span>
                            </div>
                            <!-- Snare Track -->
                            <div class="step-seq-track-header" data-track="snare">
                                <div class="smart-rand-btn" title="Smart Randomize">
                                    <svg viewBox="0 0 24 24" class="dice-icon">
                                        <rect x="3" y="3" width="18" height="18" rx="3" fill="none" stroke="currentColor" stroke-width="2"/>
                                        <circle cx="8" cy="8" r="1.5" fill="currentColor"/>
                                        <circle cx="12" cy="12" r="1.5" fill="currentColor"/>
                                        <circle cx="16" cy="16" r="1.5" fill="currentColor"/>
                                    </svg>
                                    <span class="smart-rand-label">Smart Rand</span>
                                </div>
                                <span class="step-seq-track-name" style="color: #4DFFFF;">Snare</span>
                            </div>
                            <!-- Hi-Hat Track -->
                            <div class="step-seq-track-header" data-track="hihat">
                                <div class="smart-rand-btn" title="Smart Randomize">
                                    <svg viewBox="0 0 24 24" class="dice-icon">
                                        <rect x="3" y="3" width="18" height="18" rx="3" fill="none" stroke="currentColor" stroke-width="2"/>
                                        <circle cx="8" cy="8" r="1.5" fill="currentColor"/>
                                        <circle cx="12" cy="12" r="1.5" fill="currentColor"/>
                                        <circle cx="16" cy="16" r="1.5" fill="currentColor"/>
                                    </svg>
                                    <span class="smart-rand-label">Smart Rand</span>
                                </div>
                                <span class="step-seq-track-name" style="color: #4FD272;">Hi-Hat Closed</span>
                            </div>
                            <!-- Perc Track -->
                            <div class="step-seq-track-header" data-track="perc">
                                <div class="smart-rand-btn" title="Smart Randomize">
                                    <svg viewBox="0 0 24 24" class="dice-icon">
                                        <rect x="3" y="3" width="18" height="18" rx="3" fill="none" stroke="currentColor" stroke-width="2"/>
                                        <circle cx="8" cy="8" r="1.5" fill="currentColor"/>
                                        <circle cx="12" cy="12" r="1.5" fill="currentColor"/>
                                        <circle cx="16" cy="16" r="1.5" fill="currentColor"/>
                                    </svg>
                                    <span class="smart-rand-label">Smart Rand</span>
                                </div>
                                <span class="step-seq-track-name" style="color: #D45FFF;">Perc</span>
                            </div>
                        </div>

                        <!-- Center - 16 Step Grid -->
                        <div class="step-seq-grid-area">
                            <!-- Beat Ruler with tick marks -->
                            <div class="step-seq-ruler">
                                <!-- Beat 1 -->
                                <div class="step-seq-ruler-beat">
                                    <div class="ruler-tick"><span class="beat-label">1</span></div>
                                    <div class="ruler-tick"></div>
                                    <div class="ruler-tick"></div>
                                    <div class="ruler-tick"></div>
                                </div>
                                <!-- Beat 2 -->
                                <div class="step-seq-ruler-beat">
                                    <div class="ruler-tick"><span class="beat-label">2</span></div>
                                    <div class="ruler-tick"></div>
                                    <div class="ruler-tick"></div>
                                    <div class="ruler-tick"></div>
                                </div>
                                <!-- Beat 3 -->
                                <div class="step-seq-ruler-beat">
                                    <div class="ruler-tick"><span class="beat-label">3</span></div>
                                    <div class="ruler-tick"></div>
                                    <div class="ruler-tick"></div>
                                    <div class="ruler-tick"></div>
                                </div>
                                <!-- Beat 4 -->
                                <div class="step-seq-ruler-beat">
                                    <div class="ruler-tick"><span class="beat-label">4</span></div>
                                    <div class="ruler-tick"></div>
                                    <div class="ruler-tick"></div>
                                    <div class="ruler-tick"></div>
                                </div>
                            </div>
                            <!-- Grid Rows with scroll container -->
                            <div class="step-seq-grid-scroll">
                                <!-- Pulse Visualizer -->
                                <div class="pulse-visualizer playing">
                                    <svg viewBox="0 0 200 200">
                                        <path class="pulse-ring" d="M100,30 Q130,35 145,50 Q160,70 155,100 Q150,130 130,150 Q100,170 70,155 Q45,140 40,110 Q35,75 55,50 Q75,30 100,30"/>
                                        <path class="pulse-ring" d="M100,40 Q125,44 138,55 Q152,70 148,100 Q144,125 125,142 Q100,158 75,145 Q55,132 50,108 Q45,78 62,58 Q80,40 100,40"/>
                                        <path class="pulse-ring" d="M100,50 Q120,53 130,62 Q142,74 140,100 Q138,120 122,134 Q100,148 80,136 Q65,124 62,106 Q58,82 70,66 Q84,52 100,50"/>
                                        <path class="pulse-ring" d="M100,58 Q115,60 124,68 Q134,78 132,100 Q130,118 118,128 Q100,140 84,130 Q72,120 70,104 Q68,85 78,72 Q88,60 100,58"/>
                                        <path class="pulse-ring" d="M100,66 Q112,68 118,74 Q126,82 124,100 Q122,114 112,122 Q100,132 88,124 Q78,116 76,102 Q74,88 82,78 Q90,68 100,66"/>
                                        <path class="pulse-ring" d="M100,74 Q108,75 113,80 Q118,86 117,100 Q116,110 108,116 Q100,122 92,117 Q85,112 84,101 Q83,90 88,84 Q94,76 100,74"/>
                                        <path class="pulse-ring" d="M100,82 Q105,83 108,86 Q112,90 111,100 Q110,106 106,110 Q100,114 95,110 Q90,107 89,100 Q88,94 92,89 Q96,84 100,82"/>
                                        <path class="pulse-ring" d="M100,90 Q103,90 105,92 Q107,95 106,100 Q105,103 103,105 Q100,107 97,105 Q95,103 94,100 Q94,96 96,93 Q98,91 100,90"/>
                                    </svg>
                                </div>
                                <div class="step-seq-grid">
                                    <!-- Kick Row -->
                                    <div class="step-seq-row" data-track="kick" data-color="#FF6B6B">
                                        <div class="step-beat-group">
                                            <div class="step-cell active" data-step="0"></div>
                                            <div class="step-cell" data-step="1"></div>
                                            <div class="step-cell" data-step="2"></div>
                                            <div class="step-cell active" data-step="3"></div>
                                        </div>
                                        <div class="step-beat-group">
                                            <div class="step-cell active" data-step="4"></div>
                                            <div class="step-cell" data-step="5"></div>
                                            <div class="step-cell" data-step="6"></div>
                                            <div class="step-cell active" data-step="7"></div>
                                        </div>
                                        <div class="step-beat-group">
                                            <div class="step-cell active" data-step="8"></div>
                                            <div class="step-cell" data-step="9"></div>
                                            <div class="step-cell active" data-step="10"></div>
                                            <div class="step-cell" data-step="11"></div>
                                        </div>
                                        <div class="step-beat-group">
                                            <div class="step-cell active" data-step="12"></div>
                                            <div class="step-cell" data-step="13"></div>
                                            <div class="step-cell" data-step="14"></div>
                                            <div class="step-cell" data-step="15"></div>
                                        </div>
                                    </div>
                                    <!-- Snare Row -->
                                    <div class="step-seq-row" data-track="snare" data-color="#4DFFFF">
                                        <div class="step-beat-group">
                                            <div class="step-cell" data-step="0"></div>
                                            <div class="step-cell" data-step="1"></div>
                                            <div class="step-cell" data-step="2"></div>
                                            <div class="step-cell" data-step="3"></div>
                                        </div>
                                        <div class="step-beat-group">
                                            <div class="step-cell active" data-step="4"></div>
                                            <div class="step-cell" data-step="5"></div>
                                            <div class="step-cell active" data-step="6"></div>
                                            <div class="step-cell active" data-step="7"></div>
                                        </div>
                                        <div class="step-beat-group">
                                            <div class="step-cell" data-step="8"></div>
                                            <div class="step-cell" data-step="9"></div>
                                            <div class="step-cell" data-step="10"></div>
                                            <div class="step-cell" data-step="11"></div>
                                        </div>
                                        <div class="step-beat-group">
                                            <div class="step-cell active" data-step="12"></div>
                                            <div class="step-cell" data-step="13"></div>
                                            <div class="step-cell active" data-step="14"></div>
                                            <div class="step-cell" data-step="15"></div>
                                        </div>
                                    </div>
                                    <!-- Hi-Hat Row -->
                                    <div class="step-seq-row" data-track="hihat" data-color="#4FD272">
                                        <div class="step-beat-group">
                                            <div class="step-cell active" data-step="0"></div>
                                            <div class="step-cell ghost" data-step="1"></div>
                                            <div class="step-cell active" data-step="2"></div>
                                            <div class="step-cell ghost" data-step="3"></div>
                                        </div>
                                        <div class="step-beat-group">
                                            <div class="step-cell active" data-step="4"></div>
                                            <div class="step-cell active ratchet" data-step="5" data-ratchet="3"><span class="ratchet-label">x3</span></div>
                                            <div class="step-cell active" data-step="6"></div>
                                            <div class="step-cell ghost" data-step="7"></div>
                                        </div>
                                        <div class="step-beat-group">
                                            <div class="step-cell active" data-step="8"></div>
                                            <div class="step-cell ghost" data-step="9"></div>
                                            <div class="step-cell active" data-step="10"></div>
                                            <div class="step-cell active" data-step="11"></div>
                                        </div>
                                        <div class="step-beat-group">
                                            <div class="step-cell active" data-step="12"></div>
                                            <div class="step-cell ghost" data-step="13"></div>
                                            <div class="step-cell active" data-step="14"></div>
                                            <div class="step-cell ghost" data-step="15"></div>
                                        </div>
                                    </div>
                                    <!-- Perc Row -->
                                    <div class="step-seq-row" data-track="perc" data-color="#D45FFF">
                                        <div class="step-beat-group">
                                            <div class="step-cell" data-step="0"></div>
                                            <div class="step-cell" data-step="1"></div>
                                            <div class="step-cell active" data-step="2"></div>
                                            <div class="step-cell" data-step="3"></div>
                                        </div>
                                        <div class="step-beat-group">
                                            <div class="step-cell" data-step="4"></div>
                                            <div class="step-cell" data-step="5"></div>
                                            <div class="step-cell active" data-step="6"></div>
                                            <div class="step-cell active" data-step="7"></div>
                                        </div>
                                        <div class="step-beat-group">
                                            <div class="step-cell" data-step="8"></div>
                                            <div class="step-cell" data-step="9"></div>
                                            <div class="step-cell active" data-step="10"></div>
                                            <div class="step-cell" data-step="11"></div>
                                        </div>
                                        <div class="step-beat-group">
                                            <div class="step-cell" data-step="12"></div>
                                            <div class="step-cell" data-step="13"></div>
                                            <div class="step-cell active" data-step="14"></div>
                                            <div class="step-cell" data-step="15"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Right - Control Panel -->
                        <div class="step-seq-controls">
                            <div class="kit-morph-btn" title="Kit Morph">
                                <svg viewBox="0 0 24 24" class="morph-icon">
                                    <path d="M17 1l4 4-4 4" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M3 11V9a4 4 0 014-4h14" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/>
                                    <path d="M7 23l-4-4 4-4" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M21 13v2a4 4 0 01-4 4H3" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/>
                                </svg>
                                <span class="kit-morph-label">Kit Morph</span>
                            </div>
                            <div class="humanize-control">
                                <span class="humanize-label">Humanize</span>
                                <div class="humanize-slider-container">
                                    <div class="humanize-slider-track">
                                        <div class="humanize-slider-fill" style="height: 35%;"></div>
                                    </div>
                                    <span class="humanize-value">35%</span>
                                </div>
                            </div>
                            <div class="step-count-toggle" title="Toggle 16/32 Steps">
                                <span class="step-count-value">32</span>
                                <span class="step-count-label">Steps</span>
                            </div>
                        </div>
                        </div>
                    </div>
                </div>

                <!-- Piano Roll Panel -->
                <div class="edit-dock-panel" data-panel="piano-roll">
                <div class="editor-content">
                    <!-- AI Modifier Panel -->
                    <div class="ai-modifier">
                        <div class="modifier-title">AI Modifier</div>
                        <div class="slider-group">
                            <div class="slider-label">Rhythm</div>
                            <div class="slider-bar">
                                <div class="slider-fill" style="width: 70%;"></div>
                            </div>
                        </div>
                        <div class="slider-group">
                            <div class="slider-label">Velocity</div>
                            <div class="slider-bar">
                                <div class="slider-fill" style="width: 50%;"></div>
                            </div>
                        </div>
                        <div class="slider-group">
                            <div class="slider-label">Humanize</div>
                            <div class="slider-bar">
                                <div class="slider-fill" style="width: 30%;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Piano Roll -->
                    <div class="piano-roll">
                        <!-- Time Ruler -->
                        <div class="piano-roll-ruler">
                            <div class="piano-roll-ruler-corner">
                                <span class="midi-clip-name">MIDI 02</span>
                            </div>
                            <div class="piano-roll-ruler-content" id="pianoRollRuler">
                                <!-- Generated by JS -->
                            </div>
                        </div>

                        <!-- Piano Roll Body -->
                        <div class="piano-roll-body">
                            <!-- Piano Keys -->
                            <div class="piano-keys" id="pianoKeys">
                                <!-- Generated by JS -->
                            </div>

                            <!-- MIDI Grid Container -->
                            <div class="midi-grid-container">
                                <div class="midi-grid" id="midiGrid">
                                    <!-- Grid background rows -->
                                    <div class="midi-grid-rows" id="midiGridRows">
                                        <!-- Generated by JS -->
                                    </div>
                                    <!-- Grid lines overlay -->
                                    <div class="midi-grid-lines"></div>
                                    <!-- Playhead -->
                                    <div class="piano-roll-playhead" style="left: 175px;"></div>
                                    <!-- MIDI Notes - positioned by JS -->
                                    <div id="midiNotes">
                                        <!-- Generated by JS -->
                                    </div>
                                </div>

                            </div>
                        </div>

                        <!-- Velocity Section - Cubase Style (Full Width Below) -->
                        <div class="velocity-section">
                            <div class="velocity-lane">
                                <div class="velocity-header">
                                    <div class="velocity-label-area">Velocity</div>
                                </div>
                                <div class="velocity-grid" id="velocityGrid">
                                    <!-- Velocity bars generated by JS -->
                                </div>
                                <div class="velocity-max-label">127</div>
                            </div>
                            <div class="velocity-bottom-bar">
                                <div class="velocity-controls-left">
                                    <div class="velocity-add-btn">+</div>
                                    <div class="velocity-dropdown-btn"></div>
                                </div>
                                <div class="piano-roll-scrollbar">
                                    <div class="piano-roll-scroll-track">
                                        <div class="piano-roll-scroll-thumb"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                </div>

                <!-- Mixer Panel (FL Studio Style) -->
                <div class="edit-dock-panel" data-panel="mixer">
                    <div class="mixer-wrapper">
                        <div class="mixer-content">
                            <!-- Kick Channel -->
                            <div class="channel-strip" style="--fader-color: #FF6B6B; --knob-color: #FF6B6B;">
                                <div class="mixer-track-header">
                                    <div class="mixer-color-bar" style="background: #FF6B6B; box-shadow: 0 0 8px #FF6B6B;"></div>
                                    <div class="mixer-track-name-vertical">Kick</div>
                                </div>
                                <div class="mixer-controls-row">
                                    <button class="btn-mixer-ctrl">M</button>
                                    <button class="btn-mixer-ctrl">S</button>
                                </div>
                                <div class="smart-knob-wrapper">
                                    <div class="smart-knob active" style="--knob-rotation: 45deg;">
                                        <div class="smart-knob-indicator"></div>
                                        <div class="smart-knob-value">65%</div>
                                    </div>
                                    <div class="smart-knob-label">Punch</div>
                                </div>
                                <div class="mixer-fader-section">
                                    <div class="level-meter"><div class="level-meter-fill" style="height: 75%;"></div></div>
                                    <div class="mixer-fader-track">
                                        <div class="mixer-fader-thumb" style="bottom: 70%;"></div>
                                    </div>
                                    <div class="level-meter"><div class="level-meter-fill" style="height: 72%;"></div></div>
                                </div>
                                <div class="mixer-vol-display">-3.2</div>
                            </div>

                            <!-- Snare Channel -->
                            <div class="channel-strip" style="--fader-color: #4DFFFF; --knob-color: #4DFFFF;">
                                <div class="mixer-track-header">
                                    <div class="mixer-color-bar" style="background: #4DFFFF; box-shadow: 0 0 8px #4DFFFF;"></div>
                                    <div class="mixer-track-name-vertical">Snare</div>
                                </div>
                                <div class="mixer-controls-row">
                                    <button class="btn-mixer-ctrl">M</button>
                                    <button class="btn-mixer-ctrl">S</button>
                                </div>
                                <div class="smart-knob-wrapper">
                                    <div class="smart-knob" style="--knob-rotation: 30deg;">
                                        <div class="smart-knob-indicator"></div>
                                        <div class="smart-knob-value">50%</div>
                                    </div>
                                    <div class="smart-knob-label">Crack</div>
                                </div>
                                <div class="mixer-fader-section">
                                    <div class="level-meter"><div class="level-meter-fill" style="height: 55%;"></div></div>
                                    <div class="mixer-fader-track">
                                        <div class="mixer-fader-thumb" style="bottom: 60%;"></div>
                                    </div>
                                    <div class="level-meter"><div class="level-meter-fill" style="height: 52%;"></div></div>
                                </div>
                                <div class="mixer-vol-display">-6.0</div>
                            </div>

                            <!-- Hi-Hat Channel -->
                            <div class="channel-strip" style="--fader-color: #4FD272; --knob-color: #4FD272;">
                                <div class="mixer-track-header">
                                    <div class="mixer-color-bar" style="background: #4FD272; box-shadow: 0 0 8px #4FD272;"></div>
                                    <div class="mixer-track-name-vertical">Hi-Hat</div>
                                </div>
                                <div class="mixer-controls-row">
                                    <button class="btn-mixer-ctrl">M</button>
                                    <button class="btn-mixer-ctrl active-solo">S</button>
                                </div>
                                <div class="smart-knob-wrapper">
                                    <div class="smart-knob active" style="--knob-rotation: 60deg;">
                                        <div class="smart-knob-indicator"></div>
                                        <div class="smart-knob-value">72%</div>
                                    </div>
                                    <div class="smart-knob-label">Crisp</div>
                                </div>
                                <div class="mixer-fader-section">
                                    <div class="level-meter"><div class="level-meter-fill" style="height: 45%;"></div></div>
                                    <div class="mixer-fader-track">
                                        <div class="mixer-fader-thumb" style="bottom: 50%;"></div>
                                    </div>
                                    <div class="level-meter"><div class="level-meter-fill" style="height: 42%;"></div></div>
                                </div>
                                <div class="mixer-vol-display">-8.5</div>
                            </div>

                            <!-- Perc Channel -->
                            <div class="channel-strip" style="--fader-color: #D45FFF; --knob-color: #D45FFF;">
                                <div class="mixer-track-header">
                                    <div class="mixer-color-bar" style="background: #D45FFF; box-shadow: 0 0 8px #D45FFF;"></div>
                                    <div class="mixer-track-name-vertical">Perc</div>
                                </div>
                                <div class="mixer-controls-row">
                                    <button class="btn-mixer-ctrl active-mute">M</button>
                                    <button class="btn-mixer-ctrl">S</button>
                                </div>
                                <div class="smart-knob-wrapper">
                                    <div class="smart-knob" style="--knob-rotation: -45deg;">
                                        <div class="smart-knob-indicator"></div>
                                        <div class="smart-knob-value">25%</div>
                                    </div>
                                    <div class="smart-knob-label">Body</div>
                                </div>
                                <div class="mixer-fader-section">
                                    <div class="level-meter"><div class="level-meter-fill" style="height: 0%;"></div></div>
                                    <div class="mixer-fader-track">
                                        <div class="mixer-fader-thumb" style="bottom: 5%;"></div>
                                    </div>
                                    <div class="level-meter"><div class="level-meter-fill" style="height: 0%;"></div></div>
                                </div>
                                <div class="mixer-vol-display">-</div>
                            </div>

                            <!-- Bass Channel -->
                            <div class="channel-strip" style="--fader-color: #F39C12; --knob-color: #F39C12;">
                                <div class="mixer-track-header">
                                    <div class="mixer-color-bar" style="background: #F39C12; box-shadow: 0 0 8px #F39C12;"></div>
                                    <div class="mixer-track-name-vertical">Bass</div>
                                </div>
                                <div class="mixer-controls-row">
                                    <button class="btn-mixer-ctrl">M</button>
                                    <button class="btn-mixer-ctrl">S</button>
                                </div>
                                <div class="smart-knob-wrapper">
                                    <div class="smart-knob active" style="--knob-rotation: 75deg;">
                                        <div class="smart-knob-indicator"></div>
                                        <div class="smart-knob-value">80%</div>
                                    </div>
                                    <div class="smart-knob-label">Grit</div>
                                </div>
                                <div class="mixer-fader-section">
                                    <div class="level-meter"><div class="level-meter-fill" style="height: 68%;"></div></div>
                                    <div class="mixer-fader-track">
                                        <div class="mixer-fader-thumb" style="bottom: 65%;"></div>
                                    </div>
                                    <div class="level-meter"><div class="level-meter-fill" style="height: 65%;"></div></div>
                                </div>
                                <div class="mixer-vol-display">-4.2</div>
                            </div>

                            <!-- Piano Channel -->
                            <div class="channel-strip" style="--fader-color: #5DADE2; --knob-color: #5DADE2;">
                                <div class="mixer-track-header">
                                    <div class="mixer-color-bar" style="background: #5DADE2; box-shadow: 0 0 8px #5DADE2;"></div>
                                    <div class="mixer-track-name-vertical">Piano</div>
                                </div>
                                <div class="mixer-controls-row">
                                    <button class="btn-mixer-ctrl">M</button>
                                    <button class="btn-mixer-ctrl">S</button>
                                </div>
                                <div class="smart-knob-wrapper">
                                    <div class="smart-knob" style="--knob-rotation: 20deg;">
                                        <div class="smart-knob-indicator"></div>
                                        <div class="smart-knob-value">40%</div>
                                    </div>
                                    <div class="smart-knob-label">Space</div>
                                </div>
                                <div class="mixer-fader-section">
                                    <div class="level-meter"><div class="level-meter-fill" style="height: 58%;"></div></div>
                                    <div class="mixer-fader-track">
                                        <div class="mixer-fader-thumb" style="bottom: 55%;"></div>
                                    </div>
                                    <div class="level-meter"><div class="level-meter-fill" style="height: 55%;"></div></div>
                                </div>
                                <div class="mixer-vol-display">-4.8</div>
                            </div>

                            <!-- Vocal Channel -->
                            <div class="channel-strip" style="--fader-color: #9B59B6; --knob-color: #9B59B6;">
                                <div class="mixer-track-header">
                                    <div class="mixer-color-bar" style="background: #9B59B6; box-shadow: 0 0 8px #9B59B6;"></div>
                                    <div class="mixer-track-name-vertical">Vocal</div>
                                </div>
                                <div class="mixer-controls-row">
                                    <button class="btn-mixer-ctrl">M</button>
                                    <button class="btn-mixer-ctrl">S</button>
                                </div>
                                <div class="smart-knob-wrapper">
                                    <div class="smart-knob active" style="--knob-rotation: 55deg;">
                                        <div class="smart-knob-indicator"></div>
                                        <div class="smart-knob-value">68%</div>
                                    </div>
                                    <div class="smart-knob-label">Air</div>
                                </div>
                                <div class="mixer-fader-section">
                                    <div class="level-meter"><div class="level-meter-fill" style="height: 82%;"></div></div>
                                    <div class="mixer-fader-track">
                                        <div class="mixer-fader-thumb" style="bottom: 78%;"></div>
                                    </div>
                                    <div class="level-meter"><div class="level-meter-fill" style="height: 80%;"></div></div>
                                </div>
                                <div class="mixer-vol-display">-1.5</div>
                            </div>

                            <!-- Separator -->
                            <div class="mixer-separator"></div>

                            <!-- FX Channel -->
                            <div class="channel-strip fx-strip" style="--fader-color: #FF6B9D; --knob-color: #FF6B9D;">
                                <div class="mixer-track-header">
                                    <div class="mixer-color-bar" style="background: #FF6B9D; box-shadow: 0 0 8px #FF6B9D;"></div>
                                    <div class="mixer-track-name-vertical">FX</div>
                                </div>
                                <div class="mixer-controls-row">
                                    <button class="btn-mixer-ctrl">M</button>
                                    <button class="btn-mixer-ctrl">S</button>
                                </div>
                                <div class="smart-knob-wrapper">
                                    <div class="smart-knob" style="--knob-rotation: 35deg;">
                                        <div class="smart-knob-indicator"></div>
                                        <div class="smart-knob-value">55%</div>
                                    </div>
                                    <div class="smart-knob-label">Send</div>
                                </div>
                                <div class="mixer-fader-section">
                                    <div class="level-meter"><div class="level-meter-fill" style="height: 45%;"></div></div>
                                    <div class="mixer-fader-track">
                                        <div class="mixer-fader-thumb" style="bottom: 50%;"></div>
                                    </div>
                                    <div class="level-meter"><div class="level-meter-fill" style="height: 42%;"></div></div>
                                </div>
                                <div class="mixer-vol-display">-6.0</div>
                            </div>

                            <!-- Group Channel -->
                            <div class="channel-strip group-strip" style="--fader-color: #00BFFF; --knob-color: #00BFFF;">
                                <div class="mixer-track-header">
                                    <div class="mixer-color-bar" style="background: #00BFFF; box-shadow: 0 0 8px #00BFFF;"></div>
                                    <div class="mixer-track-name-vertical">Group</div>
                                </div>
                                <div class="mixer-controls-row">
                                    <button class="btn-mixer-ctrl">M</button>
                                    <button class="btn-mixer-ctrl">S</button>
                                </div>
                                <div class="smart-knob-wrapper">
                                    <div class="smart-knob active" style="--knob-rotation: 50deg;">
                                        <div class="smart-knob-indicator"></div>
                                        <div class="smart-knob-value">62%</div>
                                    </div>
                                    <div class="smart-knob-label">Blend</div>
                                </div>
                                <div class="mixer-fader-section">
                                    <div class="level-meter"><div class="level-meter-fill" style="height: 72%;"></div></div>
                                    <div class="mixer-fader-track">
                                        <div class="mixer-fader-thumb" style="bottom: 70%;"></div>
                                    </div>
                                    <div class="level-meter"><div class="level-meter-fill" style="height: 68%;"></div></div>
                                </div>
                                <div class="mixer-vol-display">-2.5</div>
                            </div>

                            <!-- Separator 2 -->
                            <div class="mixer-separator"></div>

                            <!-- Master Channel -->
                            <div class="channel-strip master-strip" style="--fader-color: #FFD700; --knob-color: #FFD700;">
                                <div class="mixer-track-header">
                                    <div class="mixer-color-bar" style="background: #FFD700; box-shadow: 0 0 12px #FFD700;"></div>
                                    <div class="mixer-track-name-vertical">Master</div>
                                </div>
                                <div class="mixer-controls-row">
                                    <button class="btn-mixer-ctrl">M</button>
                                    <button class="btn-mixer-ctrl">S</button>
                                </div>
                                <div class="smart-knob-wrapper">
                                    <div class="smart-knob active" style="--knob-rotation: 40deg;">
                                        <div class="smart-knob-indicator"></div>
                                        <div class="smart-knob-value">58%</div>
                                    </div>
                                    <div class="smart-knob-label">Loud</div>
                                </div>
                                <div class="mixer-fader-section">
                                    <div class="level-meter"><div class="level-meter-fill" style="height: 88%;"></div></div>
                                    <div class="mixer-fader-track">
                                        <div class="mixer-fader-thumb" style="bottom: 85%;"></div>
                                    </div>
                                    <div class="level-meter"><div class="level-meter-fill" style="height: 86%;"></div></div>
                                </div>
                                <div class="mixer-vol-display">-0.1</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Audio Panel -->
                <div class="edit-dock-panel" data-panel="audio">
                    <div class="empty-panel-placeholder">Audio Editor</div>
                </div>

                <!-- Sampler Panel -->
                <div class="edit-dock-panel" data-panel="sampler">
                    <div class="empty-panel-placeholder">Sampler</div>
                </div>
            </section>
        </main>

        <!-- AI Copilot -->
        <aside class="ai-copilot">
            <div class="copilot-title">AI Copilot</div>
            <div class="chat-container">
                <div class="chat-bubble user">
                    <div class="chat-sender">User:</div>
                    <div>Make the drums quieter.</div>
                </div>
                <div class="chat-bubble ai">
                    <div class="chat-sender">AI:</div>
                    <div>Done. Adjusted volume by -3dB.</div>
                </div>
                <div class="chat-bubble user">
                    <div class="chat-sender">User:</div>
                    <div>Add reverb to the piano.</div>
                </div>
                <div class="chat-bubble ai">
                    <div class="chat-sender">AI:</div>
                    <div>Added Hall Reverb with 30% wet mix.</div>
                </div>
            </div>
            <div class="chat-input-area">
                <input type="text" class="chat-input" placeholder="Type a command...">
                <button class="send-btn">></button>
            </div>
        </aside>
    </div>

    <script>
        // Edit Dock Tab Switching
        document.querySelectorAll('.edit-dock-tab').forEach((tab, index) => {
            tab.addEventListener('click', function() {
                // Remove active from all tabs
                document.querySelectorAll('.edit-dock-tab').forEach(t => t.classList.remove('active'));
                // Add active to clicked tab
                this.classList.add('active');

                // Hide all panels
                document.querySelectorAll('.edit-dock-panel').forEach(p => p.classList.remove('active'));
                // Show corresponding panel
                const panels = document.querySelectorAll('.edit-dock-panel');
                if (panels[index]) {
                    panels[index].classList.add('active');
                }
            });
        });

        // Step Sequencer - Step Cell Click Toggle
        document.querySelectorAll('.step-cell').forEach(cell => {
            cell.addEventListener('click', function(e) {
                // Toggle active/inactive
                if (this.classList.contains('active')) {
                    this.classList.remove('active');
                    this.classList.remove('ratchet');
                    // Remove ratchet label if exists
                    const label = this.querySelector('.ratchet-label');
                    if (label) label.remove();
                } else if (this.classList.contains('ghost')) {
                    // Ghost  Active
                    this.classList.remove('ghost');
                    this.classList.add('active');
                } else {
                    // Inactive  Active
                    this.classList.add('active');
                }
            });

            // Right click for ratchet menu
            cell.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                if (!this.classList.contains('active')) return;

                // Cycle through ratchet values: none  x2  x3  x4  none
                const currentRatchet = this.dataset.ratchet || '0';
                let newRatchet = parseInt(currentRatchet) + 1;
                if (newRatchet > 4) newRatchet = 0;

                // Remove existing label
                const existingLabel = this.querySelector('.ratchet-label');
                if (existingLabel) existingLabel.remove();

                if (newRatchet >= 2) {
                    this.classList.add('ratchet');
                    this.dataset.ratchet = newRatchet;
                    const label = document.createElement('span');
                    label.className = 'ratchet-label';
                    label.textContent = 'x' + newRatchet;
                    this.appendChild(label);
                } else {
                    this.classList.remove('ratchet');
                    delete this.dataset.ratchet;
                }
            });
        });

        // Track Header Panel Expand/Collapse Toggle (All tracks at once)
        function toggleAllTracksExpand() {
            const headersPanel = document.getElementById('trackHeadersPanel');
            if (headersPanel) {
                headersPanel.classList.toggle('expanded');
            }
        }

        // Track Button Toggle (M/S/R)
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('track-btn')) {
                e.stopPropagation();
                e.target.classList.toggle('active');
            }
        });

        // Mixer Panel M/S Button Toggle
        document.querySelectorAll('.btn-mixer-ctrl').forEach(btn => {
            btn.addEventListener('click', function() {
                const isMute = this.textContent === 'M';
                const isSolo = this.textContent === 'S';

                if (isMute) {
                    this.classList.toggle('active-mute');
                } else if (isSolo) {
                    this.classList.toggle('active-solo');
                }
            });
        });

        // Smart Knob Drag Functionality
        (function() {
            let activeKnob = null;
            let startY = 0;
            let startRotation = 0;

            document.querySelectorAll('.smart-knob').forEach(knob => {
                knob.addEventListener('mousedown', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    activeKnob = this;
                    startY = e.clientY;

                    // Get current rotation
                    const style = getComputedStyle(this);
                    const currentRotation = style.getPropertyValue('--knob-rotation') || '0deg';
                    startRotation = parseFloat(currentRotation);

                    this.classList.add('active');
                    document.body.style.cursor = 'ns-resize';
                    document.body.style.userSelect = 'none';
                });
            });

            document.addEventListener('mousemove', function(e) {
                if (!activeKnob) return;

                const deltaY = startY - e.clientY;
                let newRotation = startRotation + deltaY * 1.5;

                // Clamp between -135 and 135 degrees
                newRotation = Math.max(-135, Math.min(135, newRotation));

                activeKnob.style.setProperty('--knob-rotation', newRotation + 'deg');

                // Update value display
                const valueDisplay = activeKnob.querySelector('.smart-knob-value');
                if (valueDisplay) {
                    const percent = Math.round(((newRotation + 135) / 270) * 100);
                    valueDisplay.textContent = percent + '%';
                }
            });

            document.addEventListener('mouseup', function() {
                if (activeKnob) {
                    document.body.style.cursor = '';
                    document.body.style.userSelect = '';
                    activeKnob = null;
                }
            });
        })();

        // Mixer Channel Selection
        document.querySelectorAll('.channel-strip').forEach(strip => {
            strip.addEventListener('click', function(e) {
                // M/S  ,   
                if (e.target.classList.contains('btn-mixer-ctrl') ||
                    e.target.classList.contains('mixer-fader-thumb') ||
                    e.target.classList.contains('smart-knob') ||
                    e.target.classList.contains('smart-knob-indicator')) {
                    return;
                }

                //    
                document.querySelectorAll('.channel-strip').forEach(s => {
                    s.classList.remove('selected');
                });

                //   
                this.classList.add('selected');
            });
        });

        // Mixer Fader Drag Functionality
        (function() {
            let activeFader = null;
            let faderTrack = null;
            let startY = 0;
            let startBottom = 0;

            document.querySelectorAll('.mixer-fader-thumb').forEach(thumb => {
                thumb.addEventListener('mousedown', function(e) {
                    e.preventDefault();
                    activeFader = this;
                    faderTrack = this.parentElement;
                    startY = e.clientY;
                    startBottom = parseFloat(this.style.bottom) || 50;

                    document.body.style.cursor = 'grabbing';
                    document.body.style.userSelect = 'none';
                    this.style.cursor = 'grabbing';
                });
            });

            document.addEventListener('mousemove', function(e) {
                if (!activeFader) return;

                const trackHeight = faderTrack.offsetHeight;
                const deltaY = startY - e.clientY;
                const deltaPercent = (deltaY / trackHeight) * 100;
                let newBottom = startBottom + deltaPercent;

                // Clamp between 0% and 90%
                newBottom = Math.max(0, Math.min(90, newBottom));

                activeFader.style.bottom = newBottom + '%';

                // Update volume display
                const channelStrip = activeFader.closest('.channel-strip');
                if (channelStrip) {
                    const volDisplay = channelStrip.querySelector('.mixer-vol-display');
                    if (volDisplay) {
                        // Convert position to dB (-inf to +6)
                        let db;
                        if (newBottom < 1) {
                            db = '-';
                        } else {
                            db = ((newBottom / 90) * 12 - 12 + 6).toFixed(1);
                        }
                        volDisplay.textContent = db === '-' ? db : db;
                    }

                    // Update level meters (simulate)
                    const levelMeters = channelStrip.querySelectorAll('.level-meter-fill');
                    levelMeters.forEach((meter, i) => {
                        const variation = (Math.random() * 5) - 2.5;
                        const height = Math.max(0, Math.min(100, newBottom + variation));
                        meter.style.height = height + '%';
                    });
                }
            });

            document.addEventListener('mouseup', function() {
                if (activeFader) {
                    activeFader.style.cursor = 'grab';
                    activeFader = null;
                    faderTrack = null;
                    document.body.style.cursor = '';
                    document.body.style.userSelect = '';
                }
            });
        })();

        // Timeline Divider Resize Functionality
        (function() {
            const divider = document.getElementById('timelineDivider');
            const headersPanel = document.getElementById('trackHeadersPanel');

            if (!divider || !headersPanel) return;

            let isResizing = false;
            let startX = 0;
            let startWidth = 0;

            divider.addEventListener('mousedown', function(e) {
                isResizing = true;
                startX = e.clientX;
                startWidth = headersPanel.offsetWidth;

                document.body.style.cursor = 'col-resize';
                document.body.style.userSelect = 'none';

                e.preventDefault();
            });

            document.addEventListener('mousemove', function(e) {
                if (!isResizing) return;

                const deltaX = e.clientX - startX;
                let newWidth = startWidth + deltaX;

                // Enforce min/max constraints
                const minWidth = 100;
                const maxWidth = 300;
                newWidth = Math.max(minWidth, Math.min(maxWidth, newWidth));

                headersPanel.style.width = newWidth + 'px';
            });

            document.addEventListener('mouseup', function() {
                if (isResizing) {
                    isResizing = false;
                    document.body.style.cursor = '';
                    document.body.style.userSelect = '';
                }
            });
        })();

        // Time Ruler Generation - Dynamic bar/beat markers
        (function() {
            const rulerContent = document.getElementById('timeRulerContent');
            if (!rulerContent) return;

            const barWidth = 100;  // 100px per bar
            const beatWidth = 25;  // 25px per beat (4 beats per bar)
            const totalBars = 32;  // Generate 32 bars (enough for most views)

            function generateRuler() {
                rulerContent.innerHTML = '';

                for (let bar = 1; bar <= totalBars; bar++) {
                    const barX = (bar - 1) * barWidth;

                    // Bar number marker
                    const marker = document.createElement('span');
                    marker.className = 'bar-marker';
                    marker.style.left = (barX + 5) + 'px';
                    marker.textContent = bar;
                    rulerContent.appendChild(marker);

                    // Beat ticks for this bar
                    for (let beat = 0; beat < 4; beat++) {
                        const tick = document.createElement('div');
                        tick.className = 'beat-tick ' + (beat === 0 ? 'bar' : 'beat');
                        tick.style.left = (barX + beat * beatWidth) + 'px';
                        rulerContent.appendChild(tick);
                    }
                }
            }

            generateRuler();

            // Regenerate on window resize if needed
            window.addEventListener('resize', generateRuler);
        })();

        // Piano Roll Generation - Real Piano Layout
        (function() {
            const pianoKeys = document.getElementById('pianoKeys');
            const pianoRollRuler = document.getElementById('pianoRollRuler');
            const midiGridRows = document.getElementById('midiGridRows');
            const midiNotes = document.getElementById('midiNotes');
            const velocityGrid = document.getElementById('velocityGrid');

            if (!pianoKeys) return;

            // Grid rows still have same height for MIDI editing
            const rowHeight = 14;

            // Piano key visual heights
            const whiteKeyHeight = 20;  // White keys are taller visually
            const blackKeyHeight = 16;  // Black keys are shorter

            // Generate from B5 down to C2
            const startOctave = 5;
            const endOctave = 2;

            const keyPositions = [];
            // All 12 notes in descending order for grid rows
            const allNotes = ['B', 'A#', 'A', 'G#', 'G', 'F#', 'F', 'E', 'D#', 'D', 'C#', 'C'];
            const blackNotes = ['A#', 'G#', 'F#', 'D#', 'C#'];
            const whiteNotes = ['B', 'A', 'G', 'F', 'E', 'D', 'C'];

            let currentY = 0;

            // 1. Generate MIDI grid rows (all same height - for editing)
            for (let octave = startOctave; octave >= endOctave; octave--) {
                for (const noteName of allNotes) {
                    const fullName = noteName + octave;
                    const isBlack = blackNotes.includes(noteName);

                    const gridRow = document.createElement('div');
                    gridRow.className = 'midi-row ' + (isBlack ? 'black-key' : 'white-key');
                    if (noteName === 'C') gridRow.classList.add('c-row');
                    gridRow.style.top = currentY + 'px';
                    gridRow.style.height = rowHeight + 'px';
                    midiGridRows.appendChild(gridRow);

                    keyPositions.push({
                        note: fullName,
                        y: currentY,
                        height: rowHeight,
                        isWhite: !isBlack,
                        name: noteName
                    });

                    currentY += rowHeight;
                }
            }

            // 2. Generate piano keys (Real Piano Layout)
            // White keys: 7 per octave, placed sequentially
            // Black keys: 5 per octave, overlay between white keys

            const totalOctaves = startOctave - endOctave + 1;
            const totalWhiteKeys = totalOctaves * 7;
            const whiteKeyVisualHeight = (currentY) / totalWhiteKeys;  // Fit all white keys in the grid height

            let whiteKeyY = 0;

            // Generate white keys first (B, A, G, F, E, D, C per octave from top)
            for (let octave = startOctave; octave >= endOctave; octave--) {
                for (const noteName of whiteNotes) {
                    const fullName = noteName + octave;

                    const key = document.createElement('div');
                    key.className = 'piano-key-white';
                    if (noteName === 'C') {
                        key.classList.add('c-key');
                        key.textContent = fullName;
                    }
                    key.style.top = whiteKeyY + 'px';
                    key.style.height = whiteKeyVisualHeight + 'px';
                    pianoKeys.appendChild(key);

                    whiteKeyY += whiteKeyVisualHeight;
                }
            }

            // Generate black keys (overlay between white keys)
            // Black key positions relative to white keys in each octave:
            // A# between B-A, G# between A-G, F# between G-F, D# between E-D, C# between D-C
            const blackKeyPositions = [
                { name: 'A#', afterWhite: 0 },  // After B (index 0)
                { name: 'G#', afterWhite: 1 },  // After A (index 1)
                { name: 'F#', afterWhite: 2 },  // After G (index 2)
                { name: 'D#', afterWhite: 4 },  // After E (index 4)
                { name: 'C#', afterWhite: 5 }   // After D (index 5)
            ];

            for (let octave = startOctave; octave >= endOctave; octave--) {
                const octaveOffset = (startOctave - octave) * 7 * whiteKeyVisualHeight;

                for (const bk of blackKeyPositions) {
                    const fullName = bk.name + octave;
                    const blackKeyY = octaveOffset + (bk.afterWhite + 1) * whiteKeyVisualHeight - blackKeyHeight / 2;

                    const key = document.createElement('div');
                    key.className = 'piano-key-black';
                    key.style.top = blackKeyY + 'px';
                    key.style.height = blackKeyHeight + 'px';
                    pianoKeys.appendChild(key);
                }
            }

            // Generate Piano Roll Ruler - Cubase style "9 . 4" format
            const barWidth = 100;
            const beatWidth = 25;
            const totalBars = 16;
            const startBar = 9;

            for (let bar = startBar; bar <= startBar + totalBars; bar++) {
                const barX = (bar - startBar) * barWidth;

                // Bar number with beat format: "9 . 1"
                const marker = document.createElement('span');
                marker.className = 'piano-roll-bar-marker';
                marker.style.left = (barX + 4) + 'px';
                marker.innerHTML = bar + '<span class="bar-beat"> . 1</span>';
                pianoRollRuler.appendChild(marker);

                // Beat markers: ". 2", ". 3", ". 4"
                for (let beat = 1; beat < 4; beat++) {
                    const beatMarker = document.createElement('span');
                    beatMarker.className = 'piano-roll-beat-marker';
                    beatMarker.style.left = (barX + beat * beatWidth + 2) + 'px';
                    beatMarker.textContent = '. ' + (beat + 1);
                    pianoRollRuler.appendChild(beatMarker);
                }
            }

            // Demo MIDI Notes
            const demoNotes = [
                { note: 'C#3', x: 50, width: 60, velocity: 100 },
                { note: 'C3', x: 150, width: 75, velocity: 90 },
                { note: 'C#3', x: 325, width: 100, velocity: 95 },
                { note: 'G#2', x: 250, width: 50, velocity: 80 }
            ];

            demoNotes.forEach(noteData => {
                const keyInfo = keyPositions.find(k => k.note === noteData.note);
                if (!keyInfo) return;

                const noteEl = document.createElement('div');
                noteEl.className = 'midi-note';
                noteEl.style.left = noteData.x + 'px';
                noteEl.style.top = keyInfo.y + 'px';
                noteEl.style.width = noteData.width + 'px';
                noteEl.style.height = (keyInfo.height - 2) + 'px';
                noteEl.textContent = noteData.note;
                midiNotes.appendChild(noteEl);

                const velBar = document.createElement('div');
                velBar.className = 'velocity-bar';
                velBar.style.left = (noteData.x + noteData.width / 2 - 4) + 'px';
                velBar.style.height = (noteData.velocity * 0.4) + 'px';
                velocityGrid.appendChild(velBar);
            });

        })();

        // ============================================
        // AURA Transport Control - Tone.js 
        // ============================================
        (function() {
            const playBtn = document.querySelector('.play-btn');
            const stopBtn = document.querySelector('.stop-btn');
            const bpmDisplay = document.querySelector('.bpm-value');
            const playhead = document.querySelector('.playhead');
            const pianoRollPlayhead = document.querySelector('.piano-roll-playhead');

            let isPlaying = false;
            let isInitialized = false;
            let animationFrameId = null;
            const BPM = 120;
            const BAR_WIDTH = 100; // 100px per bar

            // Tone.js  (  )
            async function initAudio() {
                if (isInitialized) return true;
                try {
                    await Tone.start();
                    Tone.Transport.bpm.value = BPM;
                    isInitialized = true;
                    console.log('AURA Audio Engine initialized');
                    return true;
                } catch (e) {
                    console.error('Audio init failed:', e);
                    return false;
                }
            }

            // Playhead 
            function updatePlayhead() {
                if (!isPlaying) return;

                const seconds = Tone.Transport.seconds;
                const beatsPerSecond = BPM / 60;
                const barsPerSecond = beatsPerSecond / 4;
                const pixelsPerSecond = BAR_WIDTH * barsPerSecond;
                const position = seconds * pixelsPerSecond;

                // Timeline playhead (offset by 530px initial position)
                if (playhead) {
                    playhead.style.left = (530 + position) + 'px';
                }

                // Piano roll playhead (offset by 175px initial position)
                if (pianoRollPlayhead) {
                    pianoRollPlayhead.style.left = (175 + position) + 'px';
                }

                animationFrameId = requestAnimationFrame(updatePlayhead);
            }

            // Play
            function play() {
                if (isPlaying) return;
                isPlaying = true;
                playBtn.classList.add('playing');
                Tone.Transport.start();
                updatePlayhead();
                console.log('Transport started');
            }

            // Stop
            function stop() {
                isPlaying = false;
                playBtn.classList.remove('playing');
                Tone.Transport.stop();
                Tone.Transport.position = 0;

                // Reset playhead positions
                if (playhead) playhead.style.left = '530px';
                if (pianoRollPlayhead) pianoRollPlayhead.style.left = '175px';

                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                    animationFrameId = null;
                }

                // Stop    (150ms)
                stopBtn.classList.add('pressed');
                setTimeout(() => stopBtn.classList.remove('pressed'), 150);

                console.log('Transport stopped');
            }

            // Play  
            playBtn.addEventListener('click', async function() {
                const ok = await initAudio();
                if (!ok) return;

                if (isPlaying) {
                    stop();
                } else {
                    play();
                }
            });

            // Stop  
            stopBtn.addEventListener('click', async function() {
                const ok = await initAudio();
                if (!ok) return;
                stop();
            });

            //   (Space = Play/Stop)
            document.addEventListener('keydown', async function(e) {
                if (e.code === 'Space' && !e.target.matches('input, textarea')) {
                    e.preventDefault();
                    const ok = await initAudio();
                    if (!ok) return;

                    if (isPlaying) {
                        stop();
                    } else {
                        play();
                    }
                }
            });

            // Record  
            const recBtn = document.querySelector('.rec-btn');
            let isRecording = false;

            function setRecording(value) {
                isRecording = value;
                if (isRecording) {
                    recBtn.classList.add('recording');
                    console.log('Recording ON');
                } else {
                    recBtn.classList.remove('recording');
                    console.log('Recording OFF');
                }
            }

            recBtn.addEventListener('click', function() {
                setRecording(!isRecording);
            });

            // Stop  Recording OFF
            const originalStop = stop;
            stop = function() {
                originalStop();
                if (isRecording) {
                    setRecording(false);
                }
            };

            console.log('AURA Transport Control loaded');
        })();
    </script>
</body>
</html>
